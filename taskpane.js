/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";function e(e){return`See https://aka.ms/msal.js.errors#${e} for details`}class t extends Error{constructor(r,n,o){const i=n||(r?e(r):"");super(i?`${r}: ${i}`:r),Object.setPrototypeOf(this,t.prototype),this.errorCode=r||"",this.errorMessage=i||"",this.subError=o||"",this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function r(r,n){return new t(r,n||e(r))}class n extends t{constructor(e,t){super(e,t),this.name="ClientAuthError",Object.setPrototypeOf(this,n.prototype)}}function o(e,t){return new n(e,t)}const i="client_info_decoding_error",s="token_parsing_error",a="null_or_empty_token",c="endpoints_resolution_error",h="invalid_state",l="state_not_found",d="auth_time_not_found",u="empty_input_scopeset",g="no_account_in_silent_request",p="invalid_cache_environment",m="no_account_found",f="no_crypto_object",y="token_refresh_required",w="key_id_missing",I="method_not_implemented",C="nested_app_auth_bridge_disabled";class v extends t{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,v.prototype)}}function k(e){return new v(e)}const b="https://login.microsoftonline.com/common/",A="common",T=`${b}discovery/instance?api-version=1.1&authorization_endpoint=`,S=".ciamlogin.com",_="openid",P="profile",E="offline_access",R="S256",O="Not Available",x="http://169.254.169.254/metadata/instance/compute/location",q=["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],M="POST",N=[_,P,E],U=[...N,"email"],H="Content-Type",L="Retry-After",F="X-AnchorMailbox",D="x-ms-request-id",z="x-ms-httpver",K="active-account-filters",B="common",j="organizations",$="consumers",J="access_token",W="login",V="consent",G="none",Q="code",X="query",Y="Generic",Z={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},ee="appmetadata",te="1",re="authority-metadata",ne="config",oe="cache",ie="network",se="hardcoded_values",ae=5,ce="server-telemetry",he=",",le={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},de="throttling";class ue{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw k("missing_kid_error");if(!e.alg)throw k("missing_alg_error");const t=new ue({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}const ge="standardInteractionClientGetDiscoveredAuthority",pe="nativeInteractionClientAcquireToken",me="acquireTokenBySilentIframe",fe="initializeBaseRequest",ye="silentIframeClientTokenHelper",we="silentHandlerInitiateAuthRequest",Ie="silentHandlerMonitorIframeForHash",Ce="standardInteractionClientCreateAuthCodeClient",ve="standardInteractionClientGetClientConfiguration",ke="standardInteractionClientInitializeAuthorizationRequest",be="handleResponseEar",Ae="handleResponsePlatformBroker",Te="handleResponseCode",Se="deserializeResponse",_e="generatePkceCodes",Pe="generateHKDF",Ee="decrypt",Re="generateEarKey";function Oe(e){return encodeURIComponent(qe(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function xe(e){return Me(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function qe(e){return Me((new TextEncoder).encode(e))}function Me(e){const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return btoa(t)}function Ne(e){return`See https://aka.ms/msal.js.errors#${e} for details`}class Ue extends t{constructor(e,t){super(e,Ne(e),t),Object.setPrototypeOf(this,Ue.prototype),this.name="BrowserAuthError"}}function He(e,t){return new Ue(e,t)}const Le="pkce_not_created",Fe="ear_jwk_empty",De="crypto_nonexistent",ze="empty_navigate_uri",Ke="no_state_in_hash",Be="unable_to_parse_state",je="user_cancelled",$e="silent_logout_unsupported",Je="non_browser_environment",We="database_not_open",Ve="no_network_connectivity",Ge="failed_to_parse_response",Qe="crypto_key_not_found",Xe="database_unavailable",Ye="native_connection_not_established",Ze="uninitialized_public_client_application",et="failed_to_decrypt_ear_response",tt="timed_out";function rt(e){return(new TextDecoder).decode(nt(e))}function nt(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw He("invalid_base64_string")}const r=atob(t);return Uint8Array.from(r,(e=>e.codePointAt(0)||0))}const ot="invalid_grant",it="msal",st="msal.js.browser",at="53ee284d-920a-4b59-9d30-a60315b26836",ct="ppnbnpeolgkicgegkbkbjmhlideopiji",ht="MicrosoftEntra",lt="Handshake",dt="localStorage",ut="sessionStorage",gt="memoryStorage",pt="signin",mt="signout",ft="request.origin",yt="urlHash",wt="request.params",It="code.verifier",Ct="interaction.status",vt="request.native",kt="wrapper.sku",bt="wrapper.version",At=861,Tt=862,St={861:"acquireTokenRedirect",862:"acquireTokenPopup",863:"ssoSilent",864:"acquireTokenSilent_authCode",865:"handleRedirectPromise",866:"acquireTokenByCode",61:"acquireTokenSilent_silentFlow",961:"logout",962:"logoutPopup",963:"hydrateCache",964:"loadExternalTokens"};var _t;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(_t||(_t={}));const Pt={scopes:N},Et="msal.db",Rt=`${Et}.keys`,Ot=[0,5,4],xt="AES-GCM",qt="HKDF",Mt="SHA-256",Nt=new Uint8Array([1,0,1]),Ut="0123456789abcdef",Ht=new Uint32Array(1),Lt="raw",Ft="encrypt",Dt="decrypt",zt={name:"RSASSA-PKCS1-v1_5",hash:Mt,modulusLength:2048,publicExponent:Nt};async function Kt(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest(Mt,t)}function Bt(e){return window.crypto.getRandomValues(e)}function jt(){return window.crypto.getRandomValues(Ht),Ht[0]}function $t(){const e=Date.now(),t=1024*jt()+(1023&jt()),r=new Uint8Array(16),n=Math.trunc(t/2**30),o=t&2**30-1,i=jt();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|n>>>8,r[7]=n,r[8]=128|o>>>24,r[9]=o>>>16,r[10]=o>>>8,r[11]=o,r[12]=i>>>24,r[13]=i>>>16,r[14]=i>>>8,r[15]=i;let s="";for(let e=0;e<r.length;e++)s+=Ut.charAt(r[e]>>>4),s+=Ut.charAt(15&r[e]),3!==e&&5!==e&&7!==e&&9!==e||(s+="-");return s}async function Jt(e){return window.crypto.subtle.exportKey("jwk",e)}async function Wt(){const e=await Gt(),t={alg:"dir",kty:"oct",k:xe(new Uint8Array(e))};return qe(JSON.stringify(t))}async function Vt(e,t){const r=t.split(".");if(5!==r.length)throw He(et,"jwe_length");const n=await async function(e){const t=rt(e),r=nt(JSON.parse(t).k);return window.crypto.subtle.importKey(Lt,r,xt,!1,[Dt])}(e).catch((()=>{throw He(et,"import_key")}));try{const e=(new TextEncoder).encode(r[0]),t=nt(r[2]),o=nt(r[3]),i=nt(r[4]),s=8*i.byteLength,a=new Uint8Array(o.length+i.length);a.set(o),a.set(i,o.length);const c=await window.crypto.subtle.decrypt({name:xt,iv:t,tagLength:s,additionalData:e},n,a);return(new TextDecoder).decode(c)}catch(e){throw He(et,"decrypt")}}async function Gt(){const e=await window.crypto.subtle.generateKey({name:xt,length:256},!0,[Ft,Dt]);return window.crypto.subtle.exportKey(Lt,e)}async function Qt(e){return window.crypto.subtle.importKey(Lt,e,qt,!1,["deriveKey"])}async function Xt(e,t,r){return window.crypto.subtle.deriveKey({name:qt,salt:t,hash:Mt,info:(new TextEncoder).encode(r)},e,{name:xt,length:256},!1,[Ft,Dt])}async function Yt(e,t,r){const n=(new TextEncoder).encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),i=await Xt(e,o,r),s=await window.crypto.subtle.encrypt({name:xt,iv:new Uint8Array(12)},i,n);return{data:xe(new Uint8Array(s)),nonce:xe(o)}}async function Zt(e,t,r,n){const o=nt(n),i=await Xt(e,nt(t),r),s=await window.crypto.subtle.decrypt({name:xt,iv:new Uint8Array(12)},i,o);return(new TextDecoder).decode(s)}class er{constructor(){this.dbName=Et,this.version=1,this.tableName=Rt,this.dbOpen=!1}async open(){return new Promise(((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",(e=>{e.target.result.createObjectStore(this.tableName)})),r.addEventListener("success",(t=>{const r=t;this.db=r.target.result,this.dbOpen=!0,e()})),r.addEventListener("error",(()=>t(He(Xe))))}))}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r(He(We));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);n.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(r.target.result)})),n.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async setItem(e,t){return await this.validateDbIsOpen(),new Promise(((r,n)=>{if(!this.db)return n(He(We));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);o.addEventListener("success",(()=>{this.closeConnection(),r()})),o.addEventListener("error",(e=>{this.closeConnection(),n(e)}))}))}async removeItem(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r(He(We));const n=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);n.addEventListener("success",(()=>{this.closeConnection(),t()})),n.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async getKeys(){return await this.validateDbIsOpen(),new Promise(((e,t)=>{if(!this.db)return t(He(We));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",(t=>{const r=t;this.closeConnection(),e(r.target.result)})),r.addEventListener("error",(e=>{this.closeConnection(),t(e)}))}))}async containsKey(e){return await this.validateDbIsOpen(),new Promise(((t,r)=>{if(!this.db)return r(He(We));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);n.addEventListener("success",(e=>{const r=e;this.closeConnection(),t(1===r.target.result)})),n.addEventListener("error",(e=>{this.closeConnection(),r(e)}))}))}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise(((e,t)=>{const r=window.indexedDB.deleteDatabase(Et),n=setTimeout((()=>t(!1)),200);r.addEventListener("success",(()=>(clearTimeout(n),e(!0)))),r.addEventListener("blocked",(()=>(clearTimeout(n),e(!0)))),r.addEventListener("error",(()=>(clearTimeout(n),t(!1))))}))}}class tr{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach(((t,r)=>{e.push(r)})),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class rr{constructor(e){this.inMemoryCache=new tr,this.indexedDBCache=new er,this.logger=e}handleDatabaseAccessError(e,t){if(!(e instanceof Ue&&e.errorCode===Xe))throw e;this.logger.error("1wx7zz",t)}async getItem(e,t){const r=this.inMemoryCache.getItem(e);if(!r)try{return this.logger.verbose("0naxpl",t),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e,t)}return r}async setItem(e,t,r){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e,r)}}async removeItem(e,t){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e,t)}}async getKeys(e){const t=this.inMemoryCache.getKeys();if(0===t.length)try{return this.logger.verbose("1iqrbq",e),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t,e)}return t}async containsKey(e,t){const r=this.inMemoryCache.containsKey(e);if(!r)try{return this.logger.verbose("03zl2j",t),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e,t)}return r}clearInMemory(e){this.logger.verbose("03r21p",e),this.inMemoryCache.clear(),this.logger.verbose("0uksk1",e)}async clearPersistent(e){try{this.logger.verbose("0rdqut",e);const t=await this.indexedDBCache.deleteDatabase();return t&&this.logger.verbose("149ouc",e),t}catch(t){return this.handleDatabaseAccessError(t,e),!1}}}class nr{constructor(e,t,r){this.logger=e,function(e){if(!window)throw He(Je);if(!window.crypto)throw He(De);if(!e&&!window.crypto.subtle)throw He(De,"crypto_subtle_undefined")}(r??!1),this.cache=new rr(this.logger),this.performanceClient=t}createNewGuid(){return $t()}base64Encode(e){return qe(e)}base64Decode(e){return rt(e)}base64UrlEncode(e){return Oe(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement("cryptoOptsGetPublicKeyThumbprint",e.correlationId),r=await async function(e,t){return window.crypto.subtle.generateKey(zt,e,t)}(nr.EXTRACTABLE,nr.POP_KEY_USAGES),n=await Jt(r.publicKey),o=or({e:n.e,kty:n.kty,n:n.n}),i=await this.hashString(o),s=await Jt(r.privateKey),a=await async function(e){return window.crypto.subtle.importKey("jwk",e,zt,!1,["sign"])}(s);return await this.cache.setItem(i,{privateKey:a,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri},e.correlationId),t&&t.end({success:!0}),i}async removeTokenBindingKey(e,t){if(await this.cache.removeItem(e,t),await this.cache.containsKey(e,t))throw o("binding_key_not_removed")}async clearKeystore(e){this.cache.clearInMemory(e);try{return await this.cache.clearPersistent(e),!0}catch(t){return t instanceof Error?this.logger.error("1owpn8",e):this.logger.error("0yrmwo",e),!1}}async signJwt(e,t,r,n){const o=this.performanceClient?.startMeasurement("cryptoOptsSignJwt",n),i=await this.cache.getItem(t,n||"");if(!i)throw He(Qe);const s=await Jt(i.publicKey),a=or(s),c=Oe(JSON.stringify({kid:t})),h=Oe(ue.getShrHeaderString({...r?.header,alg:s.alg,kid:c}));e.cnf={jwk:JSON.parse(a)};const l=`${h}.${Oe(JSON.stringify(e))}`,d=(new TextEncoder).encode(l),u=await async function(e,t){return window.crypto.subtle.sign(zt,e,t)}(i.privateKey,d),g=`${l}.${xe(new Uint8Array(u))}`;return o&&o.end({success:!0}),g}async hashString(e){return async function(e){const t=await Kt(e);return xe(new Uint8Array(t))}(e)}}function or(e){return JSON.stringify(e,Object.keys(e).sort())}nr.POP_KEY_USAGES=["sign","verify"],nr.EXTRACTABLE=!0;const ir={createNewGuid:()=>{throw o(I)},base64Decode:()=>{throw o(I)},base64Encode:()=>{throw o(I)},base64UrlEncode:()=>{throw o(I)},encodeKid:()=>{throw o(I)},async getPublicKeyThumbprint(){throw o(I)},async removeTokenBindingKey(){throw o(I)},async clearKeystore(){throw o(I)},async signJwt(){throw o(I)},async hashString(){throw o(I)}};class sr extends t{constructor(e){super(e),this.name="ClientConfigurationError",Object.setPrototypeOf(this,sr.prototype)}}function ar(e){return new sr(e)}class cr{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),n=e=>decodeURIComponent(e.replace(/\+/g," "));return r.forEach((e=>{if(e.trim()){const[r,o]=e.split(/=(.+)/g,2);r&&o&&(t[n(r)]=n(o))}})),t}static trimArrayEntries(e){return e.map((e=>e.trim()))}static removeEmptyStringsFromArray(e){return e.filter((e=>!!e))}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}}const hr="url_parse_error",lr="invalid_claims",dr="pkce_params_missing",ur="invalid_cloud_discovery_metadata",gr="missing_ssh_jwk";class pr{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw ar("empty_url_error");e.includes("#")||(this._urlString=pr.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return cr.endsWith(t,"?")?t=t.slice(0,-1):cr.endsWith(t,"?/")&&(t=t.slice(0,-2)),cr.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw ar(hr)}if(!e.HostNameAndPort||!e.PathSegments)throw ar(hr);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw ar("authority_uri_insecure")}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return pr.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return!e||0===r.length||r[0]!==B&&r[0]!==j||(r[0]=e),pr.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw ar(hr);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let n=r.AbsolutePath.split("/");return n=n.filter((e=>e&&e.length>0)),r.PathSegments=n,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw ar(hr);return r[2]}static getAbsoluteUrl(e,t){if("/"===e[0]){const r=new pr(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new pr(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}}const mr={endpointMetadata:[{host:"login.microsoftonline.com"},{host:"login.chinacloudapi.cn",issuerHost:"login.partner.microsoftonline.cn"},{host:"login.microsoftonline.us"},{host:"login.sovcloud-identity.fr"},{host:"login.sovcloud-identity.de"},{host:"login.sovcloud-identity.sg"}].reduce(((e,{host:t,issuerHost:r})=>(e[t]=function(e,t){return{token_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/token`,jwks_uri:`https://${e}/{tenantid}/discovery/v2.0/keys`,issuer:`https://${t}/{tenantid}/v2.0`,authorization_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/authorize`,end_session_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/logout`}}(t,r||t),e)),{}),instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]},{preferred_network:"login.sovcloud-identity.fr",preferred_cache:"login.sovcloud-identity.fr",aliases:["login.sovcloud-identity.fr"]},{preferred_network:"login.sovcloud-identity.de",preferred_cache:"login.sovcloud-identity.de",aliases:["login.sovcloud-identity.de"]},{preferred_network:"login.sovcloud-identity.sg",preferred_cache:"login.sovcloud-identity.sg",aliases:["login.sovcloud-identity.sg"]}]}},fr=mr.endpointMetadata,yr=mr.instanceDiscoveryMetadata,wr=new Set;function Ir(e,t,r,n,o){if(e.trace("1bmquz",t),r&&n){const o=Cr(n,r);if(o)return e.trace("1fotbt",t),o.aliases;e.trace("14avvj",t)}return null}function Cr(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.aliases.includes(t))return n}return null}yr.metadata.forEach((e=>{e.aliases.forEach((e=>{wr.add(e)}))}));const vr="OIDC",kr="EAR",br="none",Ar="refreshTokenClientAcquireTokenWithCachedRefreshToken",Tr="getAuthCodeUrl",Sr="handleCodeResponseFromServer",_r="popTokenGenerateCnf",Pr="handleServerTokenResponse",Er="authorityUpdateMetadataWithRegionalInformation",Rr="regionDiscoveryGetRegionFromIMDS",Or=(e,t,r,n,o)=>(...i)=>{r.trace("1plfzx",o);const s=n.startMeasurement(t,o);if(o){const e=t+"CallCount";n.incrementFields({[e]:1},o)}try{const t=e(...i);return s.end({success:!0}),r.trace("1g8n6a",o),t}catch(e){r.trace("0cfd8i",o);try{r.trace(JSON.stringify(e),o)}catch(e){r.trace("00dty7",o)}throw s.end({success:!1},e),e}},xr=(e,t,r,n,o)=>(...i)=>{r.trace("1plfzx",o);const s=n.startMeasurement(t,o);if(o){const e=t+"CallCount";n.incrementFields({[e]:1},o)}return e(...i).then((e=>(r.trace("1g8n6a",o),s.end({success:!0}),e))).catch((e=>{r.trace("0cfd8i",o);try{r.trace(JSON.stringify(e),o)}catch(e){r.trace("00dty7",o)}throw s.end({success:!1},e),e}))};class qr{constructor(e,t,r,n){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=n}async detectRegion(e,t){let r=e;if(r)t.region_source="3";else{const e=qr.IMDS_OPTIONS;try{const n=await xr(this.getRegionFromIMDS.bind(this),Rr,this.logger,this.performanceClient,this.correlationId)("2020-06-01",e);if(200===n.status&&(r=n.body,t.region_source="4"),400===n.status){const n=await xr(this.getCurrentVersion.bind(this),"regionDiscoveryGetCurrentVersion",this.logger,this.performanceClient,this.correlationId)(e);if(!n)return t.region_source="1",null;const o=await xr(this.getRegionFromIMDS.bind(this),Rr,this.logger,this.performanceClient,this.correlationId)(n,e);200===o.status&&(r=o.body,t.region_source="4")}}catch(e){return t.region_source="1",null}}return r||(t.region_source="1"),r||null}async getRegionFromIMDS(e,t){return this.networkInterface.sendGetRequestAsync(`${x}?api-version=${e}&format=text`,t,2e3)}async getCurrentVersion(e){try{const t=await this.networkInterface.sendGetRequestAsync(`${x}?format=json`,e);return 400===t.status&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch(e){return null}}}function Mr(e,t){const r=function(e){if(!e)throw o(a);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw o(s);return t[2]}(e);try{const e=t(r);return JSON.parse(e)}catch(e){throw o(s)}}function Nr(e){if(!e.signin_state)return!1;const t=["kmsi","dvc_dmjd"];return e.signin_state.some((e=>t.includes(e.trim().toLowerCase())))}function Ur(e,t){if(0===t||Date.now()-3e5>e+t)throw o("max_age_transpired")}function Hr(){return Math.round((new Date).getTime()/1e3)}function Lr(e){return e.getTime()/1e3}function Fr(e){return e?new Date(1e3*Number(e)):new Date}function Dr(e,t){const r=Number(e)||0;return Hr()+t>r}function zr(e,t){const r=Number(e)+24*t*60*60*1e3;return Date.now()>r}function Kr(e){return Number(e)>Hr()}function Br(e,t,r,n,o){return{credentialType:Z.ID_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,realm:o,lastUpdatedAt:Date.now().toString()}}function jr(e,t,r,n,i,s,a,c,h,l,d,u,g){const p={homeAccountId:e,credentialType:Z.ACCESS_TOKEN,secret:r,cachedAt:Hr().toString(),expiresOn:a.toString(),extendedExpiresOn:c.toString(),environment:t,clientId:n,realm:i,target:s,tokenType:d||le.BEARER,lastUpdatedAt:Date.now().toString()};if(u&&(p.userAssertionHash=u),l&&(p.refreshOn=l.toString()),p.tokenType?.toLowerCase()!==le.BEARER.toLowerCase())switch(p.credentialType=Z.ACCESS_TOKEN_WITH_AUTH_SCHEME,p.tokenType){case le.POP:const e=Mr(r,h);if(!e?.cnf?.kid)throw o("token_claims_cnf_required_for_signedjwt");p.keyId=e.cnf.kid;break;case le.SSH:p.keyId=g}return p}function $r(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function Jr(e){return!!e&&$r(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===Z.ACCESS_TOKEN||e.credentialType===Z.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function Wr(e){return!!e&&$r(e)&&e.credentialType===Z.REFRESH_TOKEN}function Vr(){return Hr()+86400}function Gr(e,t,r){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=r,e.jwks_uri=t.jwks_uri}function Qr(e,t,r){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=r}function Xr(e){return e.expiresAt<=Hr()}qr.IMDS_OPTIONS={headers:{Metadata:"true"}};class Yr{constructor(e,t,r,n,o,i,s,a){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=n,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=s,this.correlationId=i,this.managedIdentity=a||!1,this.regionDiscovery=new qr(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(S))return 3;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case"adfs":return 1;case"dstsv2":return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new pr(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw o(c)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw o(c)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw o(c)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw o("end_session_endpoint_not_supported");return this.replacePath(this.metadata.end_session_endpoint)}throw o(c)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw o(c)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw o(c)}canReplaceTenant(e){return 1===e.PathSegments.length&&!Yr.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&this.protocolMode!==vr}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new pr(this.metadata.canonical_authority).getUrlComponents(),n=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach(((e,o)=>{let i=n[o];if(0===o&&this.canReplaceTenant(r)){const e=new pr(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==e&&(this.logger.verbose("1q3g2x",this.correlationId),i=e)}e!==i&&(t=t.replace(`/${i}/`,`/${e}/`))})),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||this.protocolMode===vr&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){const e=this.getCurrentMetadataEntity(),t=await xr(this.updateCloudDiscoveryMetadata.bind(this),"authorityUpdateCloudDiscoveryMetadata",this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await xr(this.updateEndpointMetadata.bind(this),"authorityUpdateEndpointMetadata",this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort,this.correlationId);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Vr(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==oe&&r?.source!==oe&&(e.expiresAt=Vr(),e.canonical_authority=this.canonicalAuthority);const n=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache,this.correlationId);this.cacheManager.setAuthorityMetadata(n,e,this.correlationId),this.metadata=e}async updateEndpointMetadata(e){const t=this.updateEndpointMetadataFromLocalSources(e);if(t)return t.source===se&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata&&(Gr(e,await xr(this.updateMetadataWithRegionalInformation.bind(this),Er,this.logger,this.performanceClient,this.correlationId)(t.metadata),!1),e.canonical_authority=this.canonicalAuthority),t.source;let r=await xr(this.getEndpointMetadataFromNetwork.bind(this),"authorityGetEndpointMetadataFromNetwork",this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=await xr(this.updateMetadataWithRegionalInformation.bind(this),Er,this.logger,this.performanceClient,this.correlationId)(r)),Gr(e,r,!0),ie;throw o("openid_config_error",this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("1fi0kc",this.correlationId);const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("06t0uj",this.correlationId),Gr(e,t,!1),{source:ne};this.logger.verbose("151k0p",this.correlationId);const r=this.getEndpointMetadataFromHardcodedValues();if(r)return Gr(e,r,!1),{source:se,metadata:r};this.logger.verbose("1imop5",this.correlationId);const n=Xr(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("16uq31",""),{source:oe}):(n&&this.logger.verbose("0uoibc",""),null)}isAuthoritySameType(e){return new pr(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw ar("invalid_authority_metadata")}return null}async getEndpointMetadataFromNetwork(){const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("1y65x6",this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(t,e),n=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(r.body);return n?r.body:(this.logger.verbose("1koyv8",this.correlationId),null)}catch(e){return this.logger.verbose("0a9wik",this.correlationId),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in fr?fr[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if("TryAutoDetect"!==t)return this.regionDiscoveryMetadata.region_outcome="2",this.regionDiscoveryMetadata.region_used=t,Yr.replaceWithRegionalInformation(e,t);const r=await xr(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),"regionDiscoveryDetectRegion",this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome="4",this.regionDiscoveryMetadata.region_used=r,Yr.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome="5"}return e}async updateCloudDiscoveryMetadata(e){const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await xr(this.getCloudDiscoveryMetadataFromNetwork.bind(this),"authorityGetCloudDiscoveryMetadataFromNetwork",this.logger,this.performanceClient,this.correlationId)();if(r)return Qr(e,r,!0),ie;throw ar("untrusted_authority")}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("0jhlgt",this.correlationId),this.logger.verbosePii("1fy7uz",this.correlationId),this.logger.verbosePii("08zabj",this.correlationId),this.logger.verbosePii("1o1kv3",this.correlationId);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("1nakio",this.correlationId),Qr(e,t,!1),ne;this.logger.verbose("1x74aj",this.correlationId);const r=(n=this.hostnameAndPort,Cr(yr.metadata,n));var n;if(r)return this.logger.verbose("0by47c",this.correlationId),Qr(e,r,!1),se;this.logger.verbose("0r2fzy",this.correlationId);const o=Xr(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("1uffgh",""),oe):(o&&this.logger.verbose("0uoibc",""),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("04y84h",this.correlationId),Yr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("0gszr3",this.correlationId);try{this.logger.verbose("1iifkx",this.correlationId);const e=Cr(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("0q67e3",""),e)return this.logger.verbose("0hzfao",this.correlationId),e;this.logger.verbose("1ajz3u",this.correlationId)}catch(e){throw this.logger.verbose("1wq5tu",this.correlationId),ar(ur)}}return this.isInKnownAuthorities()?(this.logger.verbose("0mt9al",this.correlationId),Yr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){const e=`${T}${this.canonicalAuthority}oauth2/v2.0/authorize`,r={};let n=null;try{const t=await this.networkInterface.sendGetRequestAsync(e,r);let o,i;if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(t.body))o=t.body,i=o.metadata,this.logger.verbosePii("1vglyt",this.correlationId);else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(t.body))return this.logger.error("0768g0",this.correlationId),null;if(this.logger.warning("062uto",this.correlationId),o=t.body,"invalid_instance"===o.error)return this.logger.error("1x90tm",this.correlationId),null;this.logger.warning("0wchdm",this.correlationId),this.logger.warning("1s5mpv",this.correlationId),this.logger.warning("1yhqpw",this.correlationId),i=[]}this.logger.verbose("1lrobr",this.correlationId),n=Cr(i,this.hostnameAndPort)}catch(e){return e instanceof t?this.logger.error("0vwhc7",this.correlationId):this.logger.error("0s2z41",this.correlationId),null}return n||(this.logger.warning("0jp28q",this.correlationId),this.logger.verbose("130sd8",this.correlationId),n=Yr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter((e=>e&&pr.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort)).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==br){const e=t.tenant?t.tenant:A;r=`${t.azureCloudInstance}/${e}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return"login.microsoftonline.com";if(this.discoveryComplete())return this.metadata.preferred_cache;throw o(c)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return wr.has(e)}static isPublicCloudAuthority(e){return q.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const n=new pr(e);n.validateAsUri();const o=n.getUrlComponents();let i=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(i=`${t}.login.microsoft.com`);const s=pr.constructAuthorityUriFromObject({...n.getUrlComponents(),HostNameAndPort:i}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=Yr.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=Yr.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=Yr.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const r=new pr(e).getUrlComponents();return 0===r.PathSegments.length&&r.HostNameAndPort.endsWith(S)&&(t=`${t}${r.HostNameAndPort.split(".")[0]}.onmicrosoft.com`),t}}function Zr(e){return e.endsWith("/")?e:`${e}/`}function en(e){const t=e.cloudDiscoveryMetadata;let r;if(t)try{r=JSON.parse(t)}catch(e){throw ar(ur)}return{canonicalAuthority:e.authority?Zr(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:r}}Yr.reservedTenantDomains=new Set(["{tenant}","{tenantid}",B,$,j]);const tn="no_tokens_found",rn="refresh_token_expired",nn="ux_not_allowed",on="bad_token",sn=["interaction_required","consent_required","login_required",on,nn,"interrupted_user"],an=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token","ux_not_allowed","interrupted_user"];class cn extends t{constructor(e,t,r,n,o,i,s,a){super(e,t,r),Object.setPrototypeOf(this,cn.prototype),this.timestamp=n||"",this.traceId=o||"",this.correlationId=i||"",this.claims=s||"",this.name="InteractionRequiredAuthError",this.errorNo=a}}function hn(e,t,r){const n=!!e&&sn.indexOf(e)>-1,o=!!r&&an.indexOf(r)>-1,i=!!t&&sn.some((e=>t.indexOf(e)>-1));return n||i||o}function ln(e,t){return new cn(e,t)}function dn(e,t){if(!e)throw o("client_info_empty_error");try{const r=t(e);return JSON.parse(r)}catch(e){throw o(i)}}function un(e){if(!e)throw o(i);const t=e.split(".",2);return{uid:t[0],utid:t.length<2?"":t[1]}}function gn(e,t){return!!e&&!!t&&e===t.split(".")[1]}function pn(e,t,r,n){if(n){const{oid:t,sub:r,tid:o,name:i,tfp:s,acr:a,preferred_username:c,upn:h,login_hint:l}=n,d=o||s||a||"";return{tenantId:d,localAccountId:t||r||"",name:i,username:c||h||"",loginHint:l,isHomeTenant:gn(d,e)}}return{tenantId:r,localAccountId:t,username:"",isHomeTenant:gn(r,e)}}function mn(e,t,r,n){let o=e;if(t){const{isHomeTenant:r,...n}=t;o={...e,...n}}if(r){const{isHomeTenant:t,...i}=pn(e.homeAccountId,e.localAccountId,e.tenantId,r);return o={...o,...i,idTokenClaims:r,idToken:n},o}return o}function fn(e){return e&&(e.tid||e.tfp||e.acr)||null}function yn(e){const t=e.tenantProfiles||[];return 0===t.length&&e.realm&&e.localAccountId&&t.push(pn(e.homeAccountId,e.localAccountId,e.realm)),{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map(t.map((e=>[e.tenantId,e]))),dataBoundary:e.dataBoundary}}function wn(e,t,r){const n=Array.from(e.tenantProfiles?.values()||[]);return 0===n.length&&e.tenantId&&e.localAccountId&&n.push(pn(e.homeAccountId,e.localAccountId,e.tenantId,e.idTokenClaims)),{authorityType:e.authorityType||Y,homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,nativeAccountId:e.nativeAccountId,realm:e.tenantId,environment:e.environment,username:e.username,loginHint:e.loginHint,name:e.name,cloudGraphHostName:t,msGraphHost:r,tenantProfiles:n,dataBoundary:e.dataBoundary}}function In(e,t,r,n,o,i){if(1!==t&&2!==t){if(e)try{const t=dn(e,n.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}r.warning("1ub6wv",o)}return i?.sub||""}function Cn(e,t,r){return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:r,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.extraParameters?.clientId}}const vn="acquireTokenSilent",kn="acquireTokenPopup",bn="acquireTokenRedirect",An="ssoSilent";class Tn{constructor(e){const t=e?cr.trimArrayEntries([...e]):[],r=t?cr.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw ar("empty_input_scopes_error");this.scopes=new Set,r.forEach((e=>this.scopes.add(e)))}static fromString(e){const t=(e||"").split(" ");return new Tn(t)}static createSearchScopes(e){const t=e&&e.length>0?e:[...N],r=new Tn(t);return r.containsOnlyOIDCScopes()?r.removeScope(E):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new Tn(t);return!!e&&r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every((e=>this.containsScope(e)))}containsOnlyOIDCScopes(){let e=0;return U.forEach((t=>{this.containsScope(t)&&(e+=1)})),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach((e=>this.appendScope(e)))}catch(e){throw o("cannot_append_scopeset")}}removeScope(e){if(!e)throw o("cannot_remove_empty_scope");this.scopes.delete(e.trim())}removeOIDCScopes(){U.forEach((e=>{this.scopes.delete(e)}))}unionScopeSets(e){if(!e)throw o(u);const t=new Set;return e.scopes.forEach((e=>t.add(e.toLowerCase()))),this.scopes.forEach((e=>t.add(e.toLowerCase()))),t}intersectingScopeSets(e){if(!e)throw o(u);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach((t=>e.push(t))),e}printScopes(){return this.scopes?this.asArray().join(" "):""}printScopesLowerCase(){return this.printScopes().toLowerCase()}}const Sn="@azure/msal-common",_n="16.1.0",Pn="cache_quota_exceeded";class En extends Error{constructor(t,r){const n=r||e(t);super(n),Object.setPrototypeOf(this,En.prototype),this.name="CacheError",this.errorCode=t,this.errorMessage=n}}function Rn(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new En(Pn):new En(e.name,e.message):new En("cache_error_unknown")}class On{constructor(e,t,r,n,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Sn,_n),this.staticAuthorityOptions=o,this.performanceClient=n}getAllAccounts(e={},t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){const r=this.getAllAccounts(e,t);return r.length>1?r.sort((e=>e.idTokenClaims?-1:1))[0]:1===r.length?r[0]:null}getBaseAccountInfo(e,t){const r=this.getAccountsFilteredBy(e,t);return r.length>0?yn(r[0]):null}buildTenantProfiles(e,t,r){return e.flatMap((e=>this.getTenantProfilesFromAccountEntity(e,t,r?.tenantId,r)))}getTenantedAccountInfoByFilter(e,t,r,n,o){let i,s=null;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;const a=this.getIdToken(e,n,t,r.tenantId);return a&&(i=Mr(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,o))?null:(s=mn(e,r,i,a?.secret),s)}getTenantProfilesFromAccountEntity(e,t,r,n){const o=yn(e);let i=o.tenantProfiles||new Map;const s=this.getTokenKeys();if(r){const e=i.get(r);if(!e)return[];i=new Map([[r,e]])}const a=[];return i.forEach((e=>{const r=this.getTenantedAccountInfoByFilter(o,s,e,t,n);r&&a.push(r)})),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}async saveCacheRecord(e,r,n,i,s){if(!e)throw o("invalid_cache_record");try{e.account&&await this.setAccount(e.account,r,n,i),e.idToken&&!1!==s?.idToken&&await this.setIdTokenCredential(e.idToken,r,n),e.accessToken&&!1!==s?.accessToken&&await this.saveAccessToken(e.accessToken,r,n),e.refreshToken&&!1!==s?.refreshToken&&await this.setRefreshTokenCredential(e.refreshToken,r,n),e.appMetadata&&this.setAppMetadata(e.appMetadata,r)}catch(e){throw this.commonLogger?.error("0j476p",r),e instanceof t?e:Rn(e)}}async saveAccessToken(e,t,r){const n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType},o=this.getTokenKeys(),i=Tn.fromString(e.target);o.accessToken.forEach((e=>{if(!this.accessTokenKeyMatchesFilter(e,n,!1))return;const r=this.getAccessTokenCredential(e,t);r&&this.credentialMatchesFilter(r,n,t)&&Tn.fromString(r.target).intersectingScopeSets(i)&&this.removeAccessToken(e,t)})),await this.setAccessTokenCredential(e,t,r)}getAccountsFilteredBy(e,t){const r=this.getAccountKeys(),n=[];return r.forEach((r=>{const o=this.getAccount(r,t);if(!o)return;if(e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId))return;if(e.username&&!this.matchUsername(o.username,e.username))return;if(e.environment&&!this.matchEnvironment(o,e.environment,t))return;if(e.realm&&!this.matchRealm(o,e.realm))return;if(e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId))return;if(e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;const i={localAccountId:e?.localAccountId,name:e?.name},s=o.tenantProfiles?.filter((e=>this.tenantProfileMatchesFilter(e,i)));s&&0===s.length||n.push(o)})),n}credentialMatchesFilter(e,t,r){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment,r))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if(e.credentialType===Z.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===le.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e,t){const r=this.getKeys(),n={};return r.forEach((r=>{if(!this.isAppMetadata(r))return;const o=this.getAppMetadata(r,t);o&&(e.environment&&!this.matchEnvironment(o,e.environment,t)||e.clientId&&!this.matchClientId(o,e.clientId)||(n[r]=o))})),n}getAuthorityMetadataByAlias(e,t){const r=this.getAuthorityMetadataKeys();let n=null;return r.forEach((r=>{if(!this.isAuthorityMetadata(r)||-1===r.indexOf(this.clientId))return;const o=this.getAuthorityMetadata(r,t);o&&-1!==o.aliases.indexOf(e)&&(n=o)})),n}removeAllAccounts(e){this.getAllAccounts({},e).forEach((t=>{this.removeAccount(t,e)}))}removeAccount(e,t){this.removeAccountContext(e,t),this.getAccountKeys().filter((t=>t.includes(e.homeAccountId)&&t.includes(e.environment))).forEach((e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)}))}removeAccountContext(e,t){const r=this.getTokenKeys(),n=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);r.idToken.filter(n).forEach((e=>{this.removeIdToken(e,t)})),r.accessToken.filter(n).forEach((e=>{this.removeAccessToken(e,t)})),r.refreshToken.filter(n).forEach((e=>{this.removeRefreshToken(e,t)}))}removeAccessToken(e,t){const r=this.getAccessTokenCredential(e,t);if(r&&(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),r.credentialType.toLowerCase()===Z.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===le.POP)){const e=r.keyId;e&&this.cryptoImpl.removeTokenBindingKey(e,t).catch((()=>{this.commonLogger.error("0cx291",t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)}))}}removeAppMetadata(e){return this.getKeys().forEach((t=>{this.isAppMetadata(t)&&this.removeItem(t,e)})),!0}getIdToken(e,t,r,n){this.commonLogger.trace("1drz22",t);const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Z.ID_TOKEN,clientId:this.clientId,realm:n},i=this.getIdTokensByFilter(o,t,r),s=i.size;if(s<1)return this.commonLogger.info("1atvtd",t),null;if(s>1){let r=i;if(!n){const n=new Map;i.forEach(((t,r)=>{t.realm===e.tenantId&&n.set(r,t)}));const o=n.size;if(o<1)return this.commonLogger.info("0ooalx",t),i.values().next().value;if(1===o)return this.commonLogger.info("1eq2vc",t),n.values().next().value;r=n}return this.commonLogger.info("1ws328",t),r.forEach(((e,r)=>{this.removeIdToken(r,t)})),this.performanceClient.addFields({multiMatchedID:i.size},t),null}return this.commonLogger.info("1sm769",t),i.values().next().value}getIdTokensByFilter(e,t,r){const n=r&&r.idToken||this.getTokenKeys().idToken,o=new Map;return n.forEach((r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...e}))return;const n=this.getIdTokenCredential(r,t);n&&this.credentialMatchesFilter(n,e,t)&&o.set(r,n)})),o}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,n){const o=t.correlationId;this.commonLogger.trace("1t7hz1",o);const i=Tn.createSearchScopes(t.scopes),s=t.authenticationScheme||le.BEARER,a=s&&s.toLowerCase()!==le.BEARER.toLowerCase()?Z.ACCESS_TOKEN_WITH_AUTH_SCHEME:Z.ACCESS_TOKEN,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a,clientId:this.clientId,realm:n||e.tenantId,target:i,tokenType:s,keyId:t.sshKid},h=r&&r.accessToken||this.getTokenKeys().accessToken,l=[];h.forEach((e=>{if(this.accessTokenKeyMatchesFilter(e,c,!0)){const t=this.getAccessTokenCredential(e,o);t&&this.credentialMatchesFilter(t,c,o)&&l.push(t)}}));const d=l.length;return d<1?(this.commonLogger.info("1nckna",o),null):d>1?(this.commonLogger.info("1wkfwp",o),l.forEach((e=>{this.removeAccessToken(this.generateCredentialKey(e),o)})),this.performanceClient.addFields({multiMatchedAT:l.length},o),null):(this.commonLogger.info("06yt98",o),l[0])}accessTokenKeyMatchesFilter(e,t,r){const n=e.toLowerCase();if(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===n.indexOf(t.realm.toLowerCase()))return!1;if(t.target){const e=t.target.asArray();for(let t=0;t<e.length;t++){if(r&&!n.includes(e[t].toLowerCase()))return!1;if(!r&&n.includes(e[t].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const r=this.getTokenKeys(),n=[];return r.accessToken.forEach((r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;const o=this.getAccessTokenCredential(r,t);o&&this.credentialMatchesFilter(o,e,t)&&n.push(o)})),n}getRefreshToken(e,t,r,n){this.commonLogger.trace("0x53vi",r);const o=t?te:void 0,i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Z.REFRESH_TOKEN,clientId:this.clientId,familyId:o},s=n&&n.refreshToken||this.getTokenKeys().refreshToken,a=[];s.forEach((e=>{if(this.refreshTokenKeyMatchesFilter(e,i)){const t=this.getRefreshTokenCredential(e,r);t&&this.credentialMatchesFilter(t,i,r)&&a.push(t)}}));const c=a.length;return c<1?(this.commonLogger.info("0dlw11",r),null):(c>1&&this.performanceClient.addFields({multiMatchedRT:c},r),this.commonLogger.info("0wcnep",r),a[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e,t){const r={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(r,t),i=Object.keys(n).map((e=>n[e])),s=i.length;if(s<1)return null;if(s>1)throw o("multiple_matching_appMetadata");return i[0]}isAppMetadataFOCI(e,t){const r=this.readAppMetadataFromCache(e,t);return!(!r||r.familyId!==te)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return!(t.toLowerCase()!==e.name?.toLowerCase())}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t,r){if(this.staticAuthorityOptions){const n=function(e,t,r){let n;const o=e.canonicalAuthority;if(o){const i=new pr(o).getUrlComponents().HostNameAndPort;n=Ir(t,r,i,e.cloudDiscoveryMetadata?.metadata)||Ir(t,r,i,yr.metadata)||e.knownAuthorities}return n||[]}(this.staticAuthorityOptions,this.commonLogger,r);if(n.includes(t)&&n.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t,r);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return!(e.realm?.toLowerCase()!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==Z.ACCESS_TOKEN&&e.credentialType!==Z.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&Tn.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(ee)}isAuthorityMetadata(e){return-1!==e.indexOf(re)}generateAuthorityMetadataCacheKey(e){return`${re}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class xn extends On{async setAccount(){throw o(I)}getAccount(){throw o(I)}async setIdTokenCredential(){throw o(I)}getIdTokenCredential(){throw o(I)}async setAccessTokenCredential(){throw o(I)}getAccessTokenCredential(){throw o(I)}async setRefreshTokenCredential(){throw o(I)}getRefreshTokenCredential(){throw o(I)}setAppMetadata(){throw o(I)}getAppMetadata(){throw o(I)}setServerTelemetry(){throw o(I)}getServerTelemetry(){throw o(I)}setAuthorityMetadata(){throw o(I)}getAuthorityMetadata(){throw o(I)}getAuthorityMetadataKeys(){throw o(I)}setThrottlingCache(){throw o(I)}getThrottlingCache(){throw o(I)}removeItem(){throw o(I)}getKeys(){throw o(I)}getAccountKeys(){throw o(I)}getTokenKeys(){throw o(I)}generateCredentialKey(){throw o(I)}generateAccountKey(){throw o(I)}}const qn="msal",Mn="browser",Nn=`${qn}.${Mn}.log.level`,Un=`${qn}.${Mn}.log.pii`,Hn=`${qn}.${Mn}.platform.auth.dom`,Ln=`${qn}.version`,Fn="account.keys",Dn="token.keys";function zn(e=2){return e<1?`${qn}.${Fn}`:`${qn}.${e}.${Fn}`}function Kn(e,t=2){return t<1?`${qn}.${Dn}.${e}`:`${qn}.${t}.${Dn}.${e}`}class Bn extends t{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Bn.prototype)}}function jn(e){return new Bn(e,Ne(e))}const $n="None";class Jn{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){const n=r[e],[o,...i]=decodeURIComponent(n).trim().split("="),s=i.join("=");if(o===t)return s}return""}getUserData(){throw o(I)}setItem(e,t,r,n=!0,o="Lax"){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(r){const e=function(e){const t=new Date;return new Date(t.getTime()+864e5*e).toUTCString()}(r);i+=`expires=${e};`}(n||o===$n)&&(i+="Secure;"),document.cookie=i}async setUserData(){return Promise.reject(o(I))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach((e=>{const r=decodeURIComponent(e).trim().split("=");t.push(r[0])})),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function Wn(e,t){const r=e.getItem(zn(t));return r?JSON.parse(r):[]}function Vn(e,t,r){const n=t.getItem(Kn(e,r));if(n){const e=JSON.parse(n);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}function Gn(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("nonce")&&e.hasOwnProperty("data")}const Qn="storage_not_supported",Xn="msal.cache.encryption";class Yn{constructor(e,t,r){if(!window.localStorage)throw jn(Qn);this.memoryStorage=new tr,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){const t=new Jn,r=t.getItem(Xn);let n={key:"",id:""};if(r)try{n=JSON.parse(r)}catch(e){}if(n.key&&n.id){const t=Or(nt,"base64Decode",this.logger,this.performanceClient,e)(n.key);this.encryptionCookie={id:n.id,key:await xr(Qt,Pe,this.logger,this.performanceClient,e)(t)}}else{const r=$t(),n=await xr(Gt,"generateBaseKey",this.logger,this.performanceClient,e)(),o=Or(xe,"urlEncodeArr",this.logger,this.performanceClient,e)(new Uint8Array(n));this.encryptionCookie={id:r,key:await xr(Qt,Pe,this.logger,this.performanceClient,e)(n)};const i={id:r,key:o};t.setItem(Xn,JSON.stringify(i),0,!0,$n)}await xr(this.importExistingCache.bind(this),"importExistingCache",this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",(t=>{this.updateCache(t,e)})),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw He(Ze);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw He(Ze);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;const n=await xr(Zt,Ee,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!n)return null;try{return{...JSON.parse(n),lastUpdatedAt:t.lastUpdatedAt}}catch(e){return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,n,o){if(!this.initialized||!this.encryptionCookie)throw He(Ze);if(o)this.setItem(e,t);else{const{data:o,nonce:i}=await xr(Yt,"encrypt",this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),s={id:this.encryptionCookie.id,nonce:i,data:o,lastUpdatedAt:n};this.setItem(e,JSON.stringify(s))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Wn(this).forEach((e=>this.removeItem(e)));const e=Vn(this.clientId,this);e.idToken.forEach((e=>this.removeItem(e))),e.accessToken.forEach((e=>this.removeItem(e))),e.refreshToken.forEach((e=>this.removeItem(e))),this.getKeys().forEach((e=>{(e.startsWith(qn)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)}))}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Wn(this);t=await this.importArray(t,e),t.length?this.setItem(zn(),JSON.stringify(t)):this.removeItem(zn());const r=Vn(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem(Kn(this.clientId),JSON.stringify(r)):this.removeItem(Kn(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let n;try{n=JSON.parse(r)}catch(e){return null}return Gn(n)?n.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),xr(Zt,Ee,this.logger,this.performanceClient,t)(this.encryptionCookie.key,n.nonce,this.getContext(e),n.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),r)}async importArray(e,t){const r=[],n=[];return e.forEach((e=>{const o=this.getItemFromEncryptedCache(e,t).then((t=>{t?(this.memoryStorage.setItem(e,t),r.push(e)):this.removeItem(e)}));n.push(o)})),await Promise.all(n),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e,t){this.logger.trace("17cxcm",t);const r=this.performanceClient.startMeasurement("localStorageUpdated");r.add({isBackground:!0});const{key:n,value:o,context:i}=e.data;return n?i&&i!==this.clientId?(this.logger.trace("04rtdy",t),void r.end({success:!1,errorCode:"contextMismatch"})):(o?(this.memoryStorage.setItem(n,o),this.logger.verbose("1vzsgt",t)):(this.memoryStorage.removeItem(n),this.logger.verbose("04ypih",t)),void r.end({success:!0})):(this.logger.error("0e10qr",t),void r.end({success:!1,errorCode:"noKey"}))}}class Zn{constructor(){if(!window.sessionStorage)throw jn(Qn)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}const eo="msal:initializeEnd",to="msal:activeAccountChanged",ro="msal:loginSuccess",no="msal:acquireTokenStart",oo="msal:acquireTokenSuccess",io="msal:acquireTokenFailure",so="msal:handleRedirectStart",ao="msal:handleRedirectEnd",co="msal:popupOpened",ho="msal:logoutStart",lo="msal:logoutSuccess",uo="msal:logoutFailure",go="msal:logoutEnd";function po(e,t){if(!e)throw o(f);if(!t)throw o(h);try{const r=t.split("|"),n=r[0],o=r.length>1?r.slice(1).join("|"):"",i=e(n);return{userRequestState:o||"",libraryState:JSON.parse(i)}}catch(e){throw o(h)}}function mo(e){if(!e)return e;let t=e.toLowerCase();return cr.endsWith(t,"?")?t=t.slice(0,-1):cr.endsWith(t,"?/")&&(t=t.slice(0,-2)),cr.endsWith(t,"/")||(t+="/"),t}function fo(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function yo(e){if(!e||e.indexOf("=")<0)return null;try{const t=fo(e),r=Object.fromEntries(new URLSearchParams(t));if(r.code||r.ear_jwe||r.error||r.error_description||r.state)return r}catch(e){throw o("hash_not_deserialized")}return null}function wo(e){const t=new Array;return e.forEach(((e,r)=>{t.push(`${r}=${encodeURIComponent(e)}`)})),t.join("&")}function Io(e){if(!e)return e;const t=e.split("#")[0];try{const e=new URL(t);return mo(e.origin+e.pathname+e.search)}catch(e){return mo(t)}}const Co="client_id",vo="redirect_uri",ko="token_type",bo="req_cnf",Ao="return_spa_code",To="x-client-xtra-sku",So="brk_client_id",_o="brk_redirect_uri",Po="instance_aware";function Eo(e,t,r){if(!t)return;const n=e.get(Co);n&&e.has(So)&&r?.addFields({embeddedClientId:n,embeddedRedirectUri:e.get(vo)},t)}function Ro(e,t){e.set("response_type",t)}function Oo(e,t,r=!0,n=N){!r||n.includes("openid")||t.includes("openid")||n.push("openid");const o=r?[...t||[],...n]:t||[],i=new Tn(o);e.set("scope",i.printScopes())}function xo(e,t){e.set(Co,t)}function qo(e,t){e.set(vo,t)}function Mo(e,t){e.set("login_hint",t)}function No(e,t){e.set(F,`UPN:${t}`)}function Uo(e,t){e.set(F,`Oid:${t.uid}@${t.utid}`)}function Ho(e,t){e.set("sid",t)}function Lo(e,t,r){const n=Xo(t,r);try{JSON.parse(n)}catch(e){throw ar(lr)}e.set("claims",n)}function Fo(e,t){e.set("client-request-id",t)}function Do(e,t){e.set("x-client-SKU",t.sku),e.set("x-client-VER",t.version),t.os&&e.set("x-client-OS",t.os),t.cpu&&e.set("x-client-CPU",t.cpu)}function zo(e,t){t?.appName&&e.set("x-app-name",t.appName),t?.appVersion&&e.set("x-app-ver",t.appVersion)}function Ko(e,t){t&&e.set("state",t)}function Bo(e,t,r){if(!t||!r)throw ar(dr);e.set("code_challenge",t),e.set("code_challenge_method",r)}function jo(e,t){e.set("client_secret",t)}function $o(e,t){t&&e.set("client_assertion",t)}function Jo(e,t){t&&e.set("client_assertion_type",t)}function Wo(e,t){e.set("grant_type",t)}function Vo(e){e.set("client_info","1")}function Go(e){e.has(Po)||e.set(Po,"true")}function Qo(e,t){Object.entries(t).forEach((([t,r])=>{!e.has(t)&&r&&e.set(t,r)}))}function Xo(e,t){let r;if(e)try{r=JSON.parse(e)}catch(e){throw ar(lr)}else r={};return t&&t.length>0&&(r.hasOwnProperty(J)||(r[J]={}),r[J].xms_cc={values:t}),JSON.stringify(r)}function Yo(e,t){t&&(e.set(ko,le.POP),e.set(bo,t))}function Zo(e,t){t&&(e.set(ko,le.SSH),e.set(bo,t))}function ei(e,t){e.set("x-client-current-telemetry",t.generateCurrentRequestHeaderValue()),e.set("x-client-last-telemetry",t.generateLastRequestHeaderValue())}function ti(e){e.set("x-ms-lib-capability","retry-after, h429")}function ri(e,t,r){e.has(So)||e.set(So,t),e.has(_o)||e.set(_o,r)}function ni(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function oi(){return window.parent!==window}let ii=null;async function si(e,t,r,n){return new Promise(((o,i)=>{t.verbose("1rf6em",n.correlationId);const{libraryState:s}=po(r.base64Decode,n.state||""),a=new BroadcastChannel(s.id);let c;const h=window.setTimeout((()=>{ii=null,a.close(),i(He(tt,"redirect_bridge_timeout"))}),e);ii={timeoutId:h,channel:a,reject:i},a.onmessage=e=>{c=e.data.payload,ii=null,clearTimeout(h),a.close(),c?o(c):i(He("redirect_bridge_empty_response"))}}))}function ai(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function ci(){if("undefined"==typeof window)throw He(Je)}function hi(e){if(!e)throw He(Ze)}function li(e){ci(),function(){if(yo(window.location.hash)&&oi())throw He("block_iframe_reload")}(),function(){if(function(){if(oi())return!1;try{const{libraryState:e}=function(){const e=window.location.hash,t=window.location.search;let r,n=!1,o=!1,i="";if(e&&e.length>1){const t="#"===e.charAt(0)?e.substring(1):e,o=new URLSearchParams(t);o.has("state")&&(n=!0,i=t,r=o)}if(t&&t.length>1){const e="?"===t.charAt(0)?t.substring(1):t,n=new URLSearchParams(e);n.has("state")&&(o=!0,i=e,r=n)}if(n&&o&&(i=`${"?"===t.charAt(0)?t.substring(1):t}${"#"===e.charAt(0)?e.substring(1):e}`,r=new URLSearchParams(i)),!i||!r)throw He("empty_response");const s=r.get("state");if(!s)throw He(Ke);const{libraryState:a}=po(rt,s),{id:c,meta:h}=a;if(!c||!h)throw He(Be,"missing_library_state");return{params:r,payload:i,urlHash:e,urlQuery:t,hasResponseInHash:n,hasResponseInQuery:o,libraryState:{id:c,meta:h}}}(),{meta:t}=e;return t.interactionType===_t.Popup}catch(e){return!1}}())throw He("block_nested_popups")}(),hi(e)}function di(e,t){if(li(e),function(e){if(oi()&&!e)throw He("redirect_in_iframe")}(t.system.allowRedirectInIframe),t.cache.cacheLocation===gt)throw jn("in_mem_redirect_unavailable")}function ui(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout((()=>{try{document.head.removeChild(t)}catch{}}),1e4)}function gi(){return $t()}const pi="5.3.0";function mi(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class fi extends On{constructor(e,t,r,n,o,i,s){super(e,r,n,o,s),this.cacheConfig=t,this.logger=n,this.internalStorage=new tr,this.browserStorage=yi(e,t.cacheLocation,n,o),this.temporaryCacheStorage=yi(e,ut,n,o),this.cookieStorage=new Jn,this.eventHandler=i}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=Wn(this.browserStorage),r=Vn(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:r.accessToken.length,preMigrateITCount:r.idToken.length,preMigrateRTCount:r.refreshToken.length},e);for(let t=0;t<2;t++){const r=t;await this.removeStaleAccounts(t,r,e)}for(let t=0;t<2;t++){const r=t;await this.migrateIdTokens(t,r,e)}const n=this.getKMSIValues();for(let t=0;t<2;t++)await this.migrateAccessTokens(t,n,e),await this.migrateRefreshTokens(t,n,e);t=Wn(this.browserStorage),r=Vn(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:r.accessToken.length,postMigrateITCount:r.idToken.length,postMigrateRTCount:r.refreshToken.length},e)}async updateOldEntry(e,t){const r=this.browserStorage.getItem(e),n=this.validateAndParseJson(r||"");if(!n)return this.browserStorage.removeItem(e),null;if(n.lastUpdatedAt){if(zr(n.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null}else n.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(n),t);const o=Gn(n)?await this.browserStorage.decryptData(e,n,t):n;return o&&$r(o)?(Jr(o)||Wr(o))&&o.expiresOn&&Dr(o.expiresOn,300)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):o:(this.performanceClient.incrementFields({invalidCacheCount:1},t),null)}async removeStaleAccounts(e,t,r){const n=Wn(this.browserStorage,e);if(0!==n.length){for(const e of[...n]){this.performanceClient.incrementFields({oldAcntCount:1},r);const o=this.browserStorage.getItem(e),i=this.validateAndParseJson(o||"");i?i.lastUpdatedAt?zr(i.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(e,i,t,r),mi(n,e)):(i.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(i),r)):mi(n,e)}this.setAccountKeys(n,r,e)}}async removeAccountOldSchema(e,t,r,n){const o=Gn(t)?await this.browserStorage.decryptData(e,t,n):t,i=o?.homeAccountId;if(i){const e=this.getTokenKeys(r);[...e.idToken].filter((e=>e.includes(i))).forEach((t=>{this.browserStorage.removeItem(t),mi(e.idToken,t)})),[...e.accessToken].filter((e=>e.includes(i))).forEach((t=>{this.browserStorage.removeItem(t),mi(e.accessToken,t)})),[...e.refreshToken].filter((e=>e.includes(i))).forEach((t=>{this.browserStorage.removeItem(t),mi(e.refreshToken,t)})),this.setTokenKeys(e,n,r)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},n),this.browserStorage.removeItem(e)}getKMSIValues(){const e={},t=this.getTokenKeys().idToken;for(const r of t){const t=this.browserStorage.getUserData(r);if(t){const r=JSON.parse(t),n=Mr(r.secret,rt);n&&(e[r.homeAccountId]=Nr(n))}}return e}async migrateIdTokens(e,t,r){const n=Vn(this.clientId,this.browserStorage,e);if(0===n.idToken.length)return;const o=Vn(this.clientId,this.browserStorage,2),i=Wn(this.browserStorage),s=Wn(this.browserStorage,t);for(const e of[...n.idToken]){this.performanceClient.incrementFields({oldITCount:1},r);const t=await this.updateOldEntry(e,r);if(!t){mi(n.idToken,e);continue}const a=i.find((e=>e.includes(t.homeAccountId))),c=s.find((e=>e.includes(t.homeAccountId)));let h=null;if(a)h=this.getAccount(a,r);else if(c){const e=this.browserStorage.getItem(c),t=this.validateAndParseJson(e||"");h=t&&Gn(t)?await this.browserStorage.decryptData(c,t,r):t}if(!h){this.performanceClient.incrementFields({skipITMigrateCount:1},r);continue}const l=Mr(t.secret,rt),d=this.generateCredentialKey(t),u=this.getIdTokenCredential(d,r),g=Object.keys(l).includes("signin_state"),p=u&&Object.keys(Mr(u.secret,rt)||{}).includes("signin_state");if(!u||t.lastUpdatedAt>u.lastUpdatedAt&&(g||!p)){const e=h.tenantProfiles||[],n=fn(l)||h.realm;if(n&&!e.find((e=>e.tenantId===n))){const t=pn(h.homeAccountId,h.localAccountId,n,l);e.push(t)}h.tenantProfiles=e;const s=this.generateAccountKey(yn(h)),a=Nr(l);await this.setUserData(s,JSON.stringify(h),r,h.lastUpdatedAt,a),i.includes(s)||i.push(s),await this.setUserData(d,JSON.stringify(t),r,t.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedITCount:1},r),o.idToken.push(d)}}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r),this.setAccountKeys(i,r)}async migrateAccessTokens(e,t,r){const n=Vn(this.clientId,this.browserStorage,e);if(0===n.accessToken.length)return;const o=Vn(this.clientId,this.browserStorage,2);for(const e of[...n.accessToken]){this.performanceClient.incrementFields({oldATCount:1},r);const i=await this.updateOldEntry(e,r);if(!i){mi(n.accessToken,e);continue}if(!(i.homeAccountId in t)){this.performanceClient.incrementFields({skipATMigrateCount:1},r);continue}const s=this.generateCredentialKey(i),a=t[i.homeAccountId];if(o.accessToken.includes(s)){const e=this.getAccessTokenCredential(s,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedATCount:1},r))}else await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedATCount:1},r),o.accessToken.push(s)}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r)}async migrateRefreshTokens(e,t,r){const n=Vn(this.clientId,this.browserStorage,e);if(0===n.refreshToken.length)return;const o=Vn(this.clientId,this.browserStorage,2);for(const e of[...n.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},r);const i=await this.updateOldEntry(e,r);if(!i){mi(n.refreshToken,e);continue}if(!(i.homeAccountId in t)){this.performanceClient.incrementFields({skipRTMigrateCount:1},r);continue}const s=this.generateCredentialKey(i),a=t[i.homeAccountId];if(o.refreshToken.includes(s)){const e=this.getRefreshTokenCredential(s,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedRTCount:1},r))}else await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedRTCount:1},r),o.refreshToken.push(s)}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r)}trackVersionChanges(e){const t=this.browserStorage.getItem(Ln);t&&(this.logger.info("1wuc87",e),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==pi&&this.setItem(Ln,pi,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}setItem(e,t,r){const n=new Array(3).fill(0),o=[];for(let i=0;i<=20;i++)try{if(this.browserStorage.setItem(e,t),i>0)for(let e=0;e<=2;e++){const t=n.slice(0,e).reduce(((e,t)=>e+t),0);if(t>=i)break;const s=i>t+n[e]?t+n[e]:i;i>t&&n[e]>0&&this.removeAccessTokenKeys(o.slice(t,s),r,e)}break}catch(s){const a=Rn(s);if(!(a.errorCode===Pn&&i<20))throw a;if(!o.length)for(let r=0;r<=2;r++)if(e===Kn(this.clientId,r)){const e=JSON.parse(t).accessToken;o.push(...e),n[r]=e.length}else{const e=this.getTokenKeys(r).accessToken;o.push(...e),n[r]=e.length}if(o.length<=i)throw a;this.removeAccessToken(o[i],r,!1)}}async setUserData(e,t,r,n,o){const i=new Array(3).fill(0),s=[];for(let a=0;a<=20;a++)try{if(await xr(this.browserStorage.setUserData.bind(this.browserStorage),"setUserData",this.logger,this.performanceClient,r)(e,t,r,n,o),a>0)for(let e=0;e<=2;e++){const t=i.slice(0,e).reduce(((e,t)=>e+t),0);if(t>=a)break;const n=a>t+i[e]?t+i[e]:a;a>t&&i[e]>0&&this.removeAccessTokenKeys(s.slice(t,n),r,e)}break}catch(e){const t=Rn(e);if(!(t.errorCode===Pn&&a<20))throw t;if(!s.length)for(let e=0;e<=2;e++){const t=this.getTokenKeys(e).accessToken;s.push(...t),i[e]=t.length}if(s.length<=a)throw t;this.removeAccessToken(s[a],r,!1)}}getAccount(e,t){this.logger.trace("1lfvm6",t);const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const n=this.validateAndParseJson(r);if(!(n&&(o=n,o&&o.hasOwnProperty("homeAccountId")&&o.hasOwnProperty("environment")&&o.hasOwnProperty("realm")&&o.hasOwnProperty("localAccountId")&&o.hasOwnProperty("username")&&o.hasOwnProperty("authorityType"))))return null;var o;const i=On.toObject({},n);var s;return this.performanceClient.addFields({accountCachedBy:(s=i.cachedByApiId,"number"==typeof s&&s in St?St[s]:"unknown")},t),i}async setAccount(e,t,r,n){this.logger.trace("1bz3wr",t);const o=this.generateAccountKey(yn(e)),i=Date.now().toString();e.lastUpdatedAt=i,e.cachedByApiId=n,await this.setUserData(o,JSON.stringify(e),t,i,r),this.addAccountKeyToMap(o,t),this.performanceClient.addFields({kmsi:r},t)}setAccountKeys(e,t,r=2){0===e.length?this.removeItem(zn(r)):this.setItem(zn(r),JSON.stringify(e),t)}getAccountKeys(){return Wn(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("0rb85k",t),this.logger.tracePii("1l9bdo",t);const r=this.getAccountKeys();return-1===r.indexOf(e)?(r.push(e),this.setItem(zn(),JSON.stringify(r),t),this.logger.verbose("0xia39",t),!0):(this.logger.verbose("0161kk",t),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("1jpigu",t),this.logger.tracePii("1xzspl",t);const r=this.getAccountKeys(),n=r.indexOf(e);n>-1?(r.splice(n,1),this.setAccountKeys(r,t)):this.logger.trace("1dytu2",t)}removeAccount(e,t){const r=this.getActiveAccount(t);r?.homeAccountId===e.homeAccountId&&r?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach((t=>{t.includes(e.homeAccountId)&&t.includes(e.environment)&&this.browserStorage.removeItem(t)}))}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),n=r.idToken.indexOf(e);n>-1&&(this.logger.info("05udv9",t),r.idToken.splice(n,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=2){this.logger.trace("17o18n",t);const n=this.getTokenKeys(r);let o=0;if(e.forEach((e=>{const t=n.accessToken.indexOf(e);t>-1&&(n.accessToken.splice(t,1),o++)})),o>0)return this.logger.info("15i5d5",t),void this.setTokenKeys(n,t,r)}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),n=r.refreshToken.indexOf(e);n>-1&&(this.logger.info("1f4fq3",t),r.refreshToken.splice(n,1),this.setTokenKeys(r,t))}getTokenKeys(e=2){return Vn(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=2){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(Kn(this.clientId,r),JSON.stringify(e),t):this.removeItem(Kn(this.clientId,r))}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("1jukz6",t),this.removeIdToken(e,t),null;const n=this.validateAndParseJson(r);return n&&(o=n)&&$r(o)&&o.hasOwnProperty("realm")&&o.credentialType===Z.ID_TOKEN?(this.logger.trace("01ju66",t),n):(this.logger.trace("1jukz6",t),null);var o}async setIdTokenCredential(e,t,r){this.logger.trace("13hjll",t);const n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);const i=this.getTokenKeys();-1===i.idToken.indexOf(n)&&(this.logger.info("07jy92",t),i.idToken.push(n),this.setTokenKeys(i,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0bqvx8",t),this.removeAccessTokenKeys([e],t),null;const n=this.validateAndParseJson(r);return n&&Jr(n)?(this.logger.trace("1o81rl",t),n):(this.logger.trace("0bqvx8",t),null)}async setAccessTokenCredential(e,t,r){this.logger.trace("1pondb",t);const n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);const i=this.getTokenKeys(),s=i.accessToken.indexOf(n);-1!==s&&i.accessToken.splice(s,1),this.logger.trace("1onhey",t),i.accessToken.push(n),this.setTokenKeys(i,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0jlizt",t),this.removeRefreshToken(e,t),null;const n=this.validateAndParseJson(r);return n&&Wr(n)?(this.logger.trace("0nokxi",t),n):(this.logger.trace("0jlizt",t),null)}async setRefreshTokenCredential(e,t,r){this.logger.trace("0tcg8d",t);const n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);const i=this.getTokenKeys();-1===i.refreshToken.indexOf(n)&&(this.logger.info("0eckjs",t),i.refreshToken.push(n),this.setTokenKeys(i,t))}getAppMetadata(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1q101h",t),null;const n=this.validateAndParseJson(r);return n&&((o=n)&&0===e.indexOf(ee)&&o.hasOwnProperty("clientId")&&o.hasOwnProperty("environment"))?(this.logger.trace("19pvg2",t),n):(this.logger.trace("1q101h",t),null);var o}setAppMetadata(e,t){this.logger.trace("0cyma6",t);const r=function({environment:e,clientId:t}){return[ee,e,t].join("-").toLowerCase()}(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("0jk19c",t),null;const n=this.validateAndParseJson(r);return n&&function(e,t){const r=0===e.indexOf(ce);let n=!0;return t&&(n=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&n}(e,n)?(this.logger.trace("12jguk",t),n):(this.logger.trace("0jk19c",t),null)}setServerTelemetry(e,t,r){this.logger.trace("1poh61",r),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e,t){const r=this.internalStorage.getItem(e);if(!r)return this.logger.trace("1r39oe",t),null;const n=this.validateAndParseJson(r);return n&&function(e,t){return!!t&&0===e.indexOf(re)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,n)?(this.logger.trace("1ohvk3",t),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter((e=>this.isAuthorityMetadata(e)))}setWrapperMetadata(e,t){this.internalStorage.setItem(kt,e),this.internalStorage.setItem(bt,t)}getWrapperMetadata(){return[this.internalStorage.getItem(kt)||"",this.internalStorage.getItem(bt)||""]}setAuthorityMetadata(e,t,r){this.logger.trace("07w8n2",r),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(K),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("08gw0e",e),null;const n=this.validateAndParseJson(r);return n?(this.logger.trace("1t3ch7",e),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId},e)):(this.logger.trace("0me1up",e),null)}setActiveAccount(e,t){const r=this.generateCacheKey(K);if(e){this.logger.verbose("0rsj80",t);const n={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.setItem(r,JSON.stringify(n),t)}else this.logger.verbose("1bp5z5",t),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(to,t)}getThrottlingCache(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1h4wa6",t),null;const n=this.validateAndParseJson(r);return n&&function(e,t){let r=!1;e&&(r=0===e.indexOf(de));let n=!0;return t&&(n=t.hasOwnProperty("throttleTime")),r&&n}(e,n)?(this.logger.trace("0of6n8",t),n):(this.logger.trace("1h4wa6",t),null)}setThrottlingCache(e,t,r){this.logger.trace("0wfgh6",r),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t,r){const n=r?this.generateCacheKey(e):e,o=this.temporaryCacheStorage.getItem(n);if(!o){if(this.cacheConfig.cacheLocation===dt){const e=this.browserStorage.getItem(n);if(e)return this.logger.trace("1yt61y",t),e}return this.logger.trace("1qhy81",t),null}return o}setTemporaryCache(e,t,r){const n=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(n,t)}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e)}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach((e=>{-1===e.indexOf(qn)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)})),this.browserStorage.getKeys().forEach((e=>{-1===e.indexOf(qn)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)})),this.internalStorage.clear()}generateCacheKey(e){return cr.startsWith(e,qn)?e:`${qn}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===Z.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==le.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${qn}.2`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",r].join("|").toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${qn}.2`,e.homeAccountId,e.environment,t||e.tenantId||""].join("|").toLowerCase()}resetRequestCache(e){this.logger.trace("0h0ynu",e),this.removeTemporaryItem(this.generateCacheKey(wt)),this.removeTemporaryItem(this.generateCacheKey(It)),this.removeTemporaryItem(this.generateCacheKey(ft)),this.removeTemporaryItem(this.generateCacheKey(yt)),this.removeTemporaryItem(this.generateCacheKey(vt)),this.setInteractionInProgress(!1,void 0)}cacheAuthorizeRequest(e,t,r){this.logger.trace("1tzef5",t);const n=qe(JSON.stringify(e));if(this.setTemporaryCache(wt,n,!0),r){const e=qe(r);this.setTemporaryCache(It,e,!0)}}getCachedRequest(e){this.logger.trace("0uen20",e);const t=this.getTemporaryCache(wt,e,!0);if(!t)throw He("no_token_request_cache_error");const r=this.getTemporaryCache(It,e,!0);let n,o="";try{n=JSON.parse(rt(t)),r&&(o=rt(r))}catch(t){throw this.logger.errorPii("0ewsey",e),this.logger.error("0tvdic",e),He("unable_to_parse_token_request_cache_error")}return[n,o]}getCachedNativeRequest(){this.logger.trace("1yxcdm","");const e=this.getTemporaryCache(vt,"",!0);if(!e)return this.logger.trace("0mnxd4",""),null;return this.validateAndParseJson(e)||(this.logger.error("0rrkip",""),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${qn}.${Ct}`,t=this.getTemporaryCache(e,"",!1);try{return t?JSON.parse(t):null}catch(t){return this.logger.error("0jjyys",""),this.removeTemporaryItem(e),this.resetRequestCache(""),ni(window),null}}setInteractionInProgress(e,t=pt,r=!1,n=""){const o=`${qn}.${Ct}`;if(e){if(this.getInteractionInProgress()){if(!r)throw He("interaction_in_progress");this.logger.warning("1pmscr",n),function(e,t){ii&&(e.verbose("18y01k",t),clearTimeout(ii.timeoutId),ii.channel.close(),ii.reject(He("interaction_in_progress_cancelled")),ii=null)}(this.logger,n),this.removeTemporaryItem(o)}this.setTemporaryCache(o,JSON.stringify({clientId:this.clientId,type:t}),!1)}else e||this.getInteractionInProgress()?.clientId!==this.clientId||this.removeTemporaryItem(o)}async hydrateCache(e,t){const r={idToken:Br(e.account.homeAccountId,e.account.environment,e.idToken,this.clientId,e.tenantId),accessToken:jr(e.account.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?Lr(e.expiresOn):0,e.extExpiresOn?Lr(e.extExpiresOn):0,rt,void 0,e.tokenType,void 0,t.sshKid)};return this.saveCacheRecord(r,e.correlationId,Nr(Mr(e.idToken,rt)),963)}async saveCacheRecord(e,t,r,n,o){try{await super.saveCacheRecord(e,t,r,n,o)}catch(e){if(e instanceof En&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}function yi(e,t,r,n){try{switch(t){case dt:return new Yn(e,r,n);case ut:return new Zn}}catch(e){r.error(e,"")}return new tr}const wi=(e,t,r,n)=>new fi(e,{cacheLocation:gt,cacheRetentionDays:5},ir,t,r,n);function Ii(e,t,r,n,o){return e.verbose("1yd030",n),r?t.getAllAccounts(o,n):[]}function Ci(e,t,r,n){if(t.trace("0u7b90",n),0===Object.keys(e).length)return t.warning("1kz0cu",n),null;const o=r.getAccountInfoFilteredBy(e,n);return o?(t.verbose("0btgll",n),o):(t.verbose("0ltaj5",n),null)}function vi(e,t,r){t.setActiveAccount(e,r)}function ki(e,t){return e.getActiveAccount(t)}var bi;!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(bi||(bi={}));const Ai=new Map;class Ti{constructor(e,t,r){this.level=bi.Info;const n=e||Ti.createDefaultLoggerOptions();this.localCallback=n.loggerCallback||(()=>{}),this.piiLoggingEnabled=n.piiLoggingEnabled||!1,this.level="number"==typeof n.logLevel?n.logLevel:bi.Info,this.packageName=t||"",this.packageVersion=r||""}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:bi.Info}}clone(e,t){return new Ti({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level},e,t)}logMessage(e,t){const r=t.correlationId;if(function(e){if(6!==e.length)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(!(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"))return!1}return!0}(e)&&function(e,t){const r=Date.now();let n=Ai.get(e);if(n)!function(e,t){Ai.delete(e),Ai.set(e,t)}(e,n);else if(n={logs:[],firstEventTime:r},Ai.set(e,n),Ai.size>50){const e=Ai.keys().next().value;e&&Ai.delete(e)}n.logs.push({...t,milliseconds:r-n.firstEventTime}),n.logs.length>500&&n.logs.shift()}(r,{hash:e,level:t.logLevel,containsPii:t.containsPii||!1,milliseconds:0}),t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const n=`[${(new Date).toUTCString()}] : [${r}] : ${this.packageName}@${this.packageVersion} : ${bi[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,n,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:bi.Error,containsPii:!1,correlationId:t})}errorPii(e,t){this.logMessage(e,{logLevel:bi.Error,containsPii:!0,correlationId:t})}warning(e,t){this.logMessage(e,{logLevel:bi.Warning,containsPii:!1,correlationId:t})}warningPii(e,t){this.logMessage(e,{logLevel:bi.Warning,containsPii:!0,correlationId:t})}info(e,t){this.logMessage(e,{logLevel:bi.Info,containsPii:!1,correlationId:t})}infoPii(e,t){this.logMessage(e,{logLevel:bi.Info,containsPii:!0,correlationId:t})}verbose(e,t){this.logMessage(e,{logLevel:bi.Verbose,containsPii:!1,correlationId:t})}verbosePii(e,t){this.logMessage(e,{logLevel:bi.Verbose,containsPii:!0,correlationId:t})}trace(e,t){this.logMessage(e,{logLevel:bi.Trace,containsPii:!1,correlationId:t})}tracePii(e,t){this.logMessage(e,{logLevel:bi.Trace,containsPii:!0,correlationId:t})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}class Si{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Ti({}),"undefined"!=typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if("undefined"!=typeof window){const n=r||gi();return this.eventCallbacks.has(n)?(this.logger.error("1578i0",""),null):(this.eventCallbacks.set(n,[e,t||[]]),this.logger.verbose("1cnec4",""),n)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("12zotd","")}emitEvent(e,t,r,n,o){const i={eventType:e,interactionType:r||null,payload:n||null,error:o||null,correlationId:t,timestamp:Date.now()};switch(e){case ro:case lo:case to:this.broadcastChannel?.postMessage(i)}this.invokeCallbacks(i)}invokeCallbacks(e){this.eventCallbacks.forEach((([t,r],n)=>{(0===r.length||r.includes(e.eventType))&&(this.logger.verbose("15jpwk",""),t.apply(null,[e]))}))}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT","unencryptedCacheCount","encryptedCacheExpiredCount","oldAccountCount","oldAccessCount","oldIdCount","oldRefreshCount","currAccountCount","currAccessCount","currIdCount","currRefreshCount","expiredCacheRemovedCount","upgradedCacheCount"]);class _i{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:1,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""}}}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const Pi={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Ei={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:bi.Info,correlationId:""},Ri={async sendGetRequestAsync(){throw o(I)},async sendPostRequestAsync(){throw o(I)}},Oi={sku:"msal.js.common",version:_n,cpu:"",os:""},xi={clientSecret:"",clientAssertion:void 0},qi={azureCloudInstance:br,tenant:`${A}`},Mi={application:{appName:"",appVersion:""}};function Ni({authOptions:e,systemOptions:t,loggerOptions:r,storageInterface:n,networkInterface:o,cryptoInterface:i,clientCredentials:s,libraryInfo:a,telemetry:c,serverTelemetryManager:h,persistencePlugin:l,serializableCache:d}){const u={...Ei,...r};return{authOptions:(g=e,{clientCapabilities:[],azureCloudOptions:qi,instanceAware:!1,...g}),systemOptions:{...Pi,...t},loggerOptions:u,storageInterface:n||new xn(e.clientId,ir,new Ti(u),new _i),networkInterface:o||Ri,cryptoInterface:i||ir,clientCredentials:s||xi,libraryInfo:{...Oi,...a},telemetry:{...Mi,...c},serverTelemetryManager:h||null,persistencePlugin:l||null,serializableCache:d||null};var g}function Ui(e){return e.authOptions.authority.options.protocolMode===vr}class Hi extends t{constructor(e,t,r,n,o){super(e,t,r),this.name="ServerError",this.errorNo=n,this.status=o,Object.setPrototypeOf(this,Hi.prototype)}}class Li{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){const r=await xr(this.generateKid.bind(this),_r,t,this.performanceClient,e.correlationId)(e),n=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:n}}async generateKid(e){return{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,n){const{resourceRequestMethod:o,resourceRequestUri:i,shrClaims:s,shrNonce:a,shrOptions:c}=r,h=i?new pr(i):void 0,l=h?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Hr(),m:o?.toUpperCase(),u:l?.HostNameAndPort,nonce:a||this.cryptoUtils.createNewGuid(),p:l?.AbsolutePath,q:l?.QueryString?[[],l.QueryString]:void 0,client_claims:s||void 0,...n},t,c,r.correlationId)}}class Fi{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Di{constructor(e,t,r,n,o,i,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=n,this.performanceClient=o,this.serializableCache=i,this.persistencePlugin=s}validateTokenResponse(e,t,r){if(e.error||e.error_description||e.suberror){const n=`Error(s): ${e.error_codes||O} - Timestamp: ${e.timestamp||O} - Description: ${e.error_description||O} - Correlation ID: ${e.correlation_id||O} - Trace ID: ${e.trace_id||O}`,o=e.error_codes?.length?e.error_codes[0]:void 0,i=new Hi(e.error,n,e.suberror,o,e.status);if(r&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning("16ks7j",t);if(r&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning("0g61x3",t);if(hn(e.error,e.error_description,e.suberror))throw new cn(e.error,e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o);throw i}}async handleServerTokenResponse(e,t,r,n,i,s,a,c,h,l){let u,g;if(e.id_token){if(u=Mr(e.id_token||"",this.cryptoObj.base64Decode),s&&s.nonce&&u.nonce!==s.nonce)throw o("nonce_mismatch");if(n.maxAge||0===n.maxAge){const e=u.auth_time;if(!e)throw o(d);Ur(e,n.maxAge)}}this.homeAccountIdentifier=In(e.client_info||"",t.authorityType,this.logger,this.cryptoObj,n.correlationId,u),s&&s.state&&(g=po(this.cryptoObj.base64Decode,s.state)),e.key_id=e.key_id||n.sshKid||void 0;const p=this.generateCacheRecord(e,t,r,n,u,a,s);let m;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("0jbz5k",n.correlationId),m=new Fi(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(m)),c&&!h&&p.account&&this.cacheStorage.getAllAccounts({homeAccountId:p.account.homeAccountId,environment:p.account.environment},n.correlationId).length<1)return this.logger.warning("1gmt66",n.correlationId),this.performanceClient?.addFields({acntLoggedOut:!0},n.correlationId),await Di.generateAuthenticationResult(this.cryptoObj,t,p,!1,n,this.performanceClient,u,g,void 0,l);await this.cacheStorage.saveCacheRecord(p,n.correlationId,Nr(u||{}),i,n.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&m&&(this.logger.verbose("1bh17u",n.correlationId),await this.persistencePlugin.afterCacheAccess(m))}return Di.generateAuthenticationResult(this.cryptoObj,t,p,!1,n,this.performanceClient,u,g,e,l)}generateCacheRecord(e,t,r,n,i,s,a){const c=t.getPreferredCache();if(!c)throw o(p);const h=fn(i);let l,d;e.id_token&&i&&(l=Br(this.homeAccountIdentifier,c,e.id_token,this.clientId,h||""),d=zi(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,n.correlationId,i,e.client_info,c,h,a,void 0,this.logger));let u=null;if(e.access_token){const o=e.scope?Tn.fromString(e.scope):new Tn(n.scopes||[]),i=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,a=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,l=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,d=r+i,g=d+a,p=l&&l>0?r+l:void 0;u=jr(this.homeAccountIdentifier,c,e.access_token,this.clientId,h||t.tenant||"",o.printScopes(),d,g,this.cryptoObj.base64Decode,p,e.token_type,s,e.key_id)}let g=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in),this.performanceClient?.addFields({ntwkRtExpiresOnSeconds:t},n.correlationId)),g=function(e,t,r,n,o,i,s){const a={credentialType:Z.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,lastUpdatedAt:Date.now().toString()};return i&&(a.userAssertionHash=i),o&&(a.familyId=o),s&&(a.expiresOn=s.toString()),a}(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,t)}let m=null;return e.foci&&(m={clientId:this.clientId,environment:c,familyId:e.foci}),{account:d,idToken:l,accessToken:u,refreshToken:g,appMetadata:m}}static async generateAuthenticationResult(e,t,r,n,i,s,a,c,h,l){let d,u,g="",p=[],m=null,f="";if(r.accessToken){if(r.accessToken.tokenType!==le.POP||i.popKid)g=r.accessToken.secret;else{const t=new Li(e,s),{secret:n,keyId:a}=r.accessToken;if(!a)throw o(w);g=await t.signPopToken(n,a,i)}p=Tn.fromString(r.accessToken.target).asArray(),m=Fr(r.accessToken.expiresOn),d=Fr(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(u=Fr(r.accessToken.refreshOn))}r.appMetadata&&(f=r.appMetadata.familyId===te?te:"");const y=a?.oid||a?.sub||"",I=a?.tid||"";h?.spa_accountid&&r.account&&(r.account.nativeAccountId=h?.spa_accountid);const C=r.account?mn(yn(r.account),void 0,a,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:y,tenantId:I,scopes:p,account:C,idToken:r?.idToken?.secret||"",idTokenClaims:a||{},accessToken:g,fromCache:n,expiresOn:m,extExpiresOn:d,refreshOn:u,correlationId:i.correlationId,requestId:l||"",familyId:f,tokenType:r.accessToken?.tokenType||"",state:c?c.userRequestState:"",cloudGraphHostName:r.account?.cloudGraphHostName||"",msGraphHost:r.account?.msGraphHost||"",code:h?.spa_code,fromPlatformBroker:!1}}}function zi(e,t,r,n,i,s,a,c,h,l,d,u){u?.verbose("09jz0t",i);const g=e.getAccountKeys().find((e=>e.startsWith(r)));let m=null;g&&(m=e.getAccount(g,i));const f=m||function(e,t,r){let n,i,s;n=1===t.authorityType?"ADFS":t.protocolMode===vr?Y:"MSSTS",e.clientInfo&&r&&(i=dn(e.clientInfo,r),i.xms_tdbr&&(s="EU"===i.xms_tdbr?"EU":"None"));const a=e.environment||t&&t.getPreferredCache();if(!a)throw o(p);const c=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,h=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null,l=c||h||"",d=e.idTokenClaims?.login_hint,u=i?.utid||fn(e.idTokenClaims)||"",g=i?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let m;return m=e.tenantProfiles?e.tenantProfiles:[pn(e.homeAccountId,g,u,e.idTokenClaims)],{homeAccountId:e.homeAccountId,environment:a,realm:u,localAccountId:g,username:l,authorityType:n,loginHint:d,clientInfo:e.clientInfo,name:e.idTokenClaims?.name||"",lastModificationTime:void 0,lastModificationApp:void 0,cloudGraphHostName:e.cloudGraphHostName,msGraphHost:e.msGraphHost,nativeAccountId:e.nativeAccountId,tenantProfiles:m,dataBoundary:s}}({homeAccountId:r,idTokenClaims:s,clientInfo:a,environment:c,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:d},t,n),y=f.tenantProfiles||[],w=h||f.realm;if(w&&!y.find((e=>e.tenantId===w))){const e=pn(r,f.localAccountId,w,s);y.push(e)}return f.tenantProfiles=y,f}const Ki="home_account_id",Bi="UPN";async function ji(e,t,r){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:r})}class $i{static generateThrottlingStorageKey(e){return`${de}.${JSON.stringify(e)}`}static preProcess(e,t,r){const n=$i.generateThrottlingStorageKey(t),o=e.getThrottlingCache(n,r);if(o){if(o.throttleTime<Date.now())return void e.removeItem(n,r);throw new Hi(o.errorCodes?.join(" ")||"",o.errorMessage,o.subError)}}static postProcess(e,t,r,n){if($i.checkResponseStatus(r)||$i.checkResponseForRetryAfter(r)){const o={throttleTime:$i.calculateThrottleTime(parseInt(r.headers[L])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache($i.generateThrottlingStorageKey(t),o,n)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(L)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))}static removeThrottle(e,t,r,n){const o=Cn(t,r,n),i=this.generateThrottlingStorageKey(o);e.removeItem(i,r.correlationId)}}class Ji extends t{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Ji.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function Wi(e,t,r,n){return e.errorMessage=`${e.errorMessage}, additionalErrorInfo: error.name:${n?.name}, error.message:${n?.message}`,new Ji(e,t,r)}function Vi(e,t,r){const n={};if(n[H]="application/x-www-form-urlencoded;charset=utf-8",!t&&r)switch(r.type){case Ki:try{const e=un(r.credential);n[F]=`Oid:${e.uid}@${e.utid}`}catch(t){e.verbose("1qhtee","")}break;case Bi:n[F]=`UPN: ${r.credential}`}return n}function Gi(e,t,r,n){const o=new Map;return e.embeddedClientId&&ri(o,t,r),e.extraQueryParameters&&Qo(o,e.extraQueryParameters),Fo(o,e.correlationId),Eo(o,e.correlationId,n),wo(o)}async function Qi(e,r,n,i,s,a,c,h,l,d){const u=await async function(e,r,n,i,s,a,c,h){let l;$i.preProcess(s,e,i);try{l=await xr(a.sendPostRequestAsync.bind(a),"networkClientSendPostRequestAsync",c,h,i)(r,n);const e=l.headers||{};h?.addFields({refreshTokenSize:l.body.refresh_token?.length||0,httpVerToken:e[z]||"",requestId:e[D]||""},i)}catch(e){if(e instanceof Ji){const t=e.responseHeaders;throw t&&h?.addFields({httpVerToken:t[z]||"",requestId:t[D]||"",contentTypeHeader:t[H]||void 0,contentLengthHeader:t["Content-Length"]||void 0,httpStatus:e.httpStatus},i),e.error}throw e instanceof t?e:o("network_error")}return $i.postProcess(s,e,l,i),l}(i,e,{body:r,headers:n},s,a,c,h,l);return d&&u.status<500&&429!==u.status&&d.clearTelemetryCache(),u}async function Xi(e,t,r,n,i,s,a){const h=Yr.transformCIAMAuthority(Zr(e)),l=new Yr(h,t,r,n,i,s,a);try{return await xr(l.resolveEndpointsAsync.bind(l),"authorityResolveEndpointsAsync",i,a,s)(),l}catch(e){throw o(c)}}class Yi{constructor(e,t){this.includeRedirectUri=!0,this.config=Ni(e),this.logger=new Ti(this.config.loggerOptions,Sn,_n),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t,r){if(!e.code)throw o("request_cannot_be_made");r&&r.cloud_instance_host_name&&await xr(this.updateTokenEndpointAuthority.bind(this),"updateTokenEndpointAuthority",this.logger,this.performanceClient,e.correlationId)(r.cloud_instance_host_name,e.correlationId);const n=Hr(),i=await xr(this.executeTokenRequest.bind(this),"authClientExecuteTokenRequest",this.logger,this.performanceClient,e.correlationId)(this.authority,e,this.serverTelemetryManager),s=i.headers?.[D],a=new Di(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(i.body,e.correlationId),xr(a.handleServerTokenResponse.bind(a),Pr,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,n,e,t,r,void 0,void 0,void 0,s)}getLogoutUri(e){if(!e)throw ar("logout_request_empty");const t=this.createLogoutUrlQueryString(e);return pr.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t,r){const n=Gi(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),o=pr.appendQueryString(e.tokenEndpoint,n),i=await xr(this.createTokenRequestBody.bind(this),"authClientCreateTokenRequestBody",this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const e=dn(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${e.uid}.${e.utid}`,type:Ki}}catch(e){this.logger.verbose("0wznt3",t.correlationId)}const a=Vi(this.logger,this.config.systemOptions.preventCorsPreflight,s||t.ccsCredential),c=Cn(this.config.authOptions.clientId,t);return xr(Qi,"authorizationCodeClientExecutePostToTokenEndpoint",this.logger,this.performanceClient,t.correlationId)(o,i,a,c,t.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,r)}async createTokenRequestBody(e){const t=new Map;if(xo(t,e.embeddedClientId||e.extraParameters?.[Co]||this.config.authOptions.clientId),this.includeRedirectUri)qo(t,e.redirectUri);else if(!e.redirectUri)throw ar("redirect_uri_empty");if(Oo(t,e.scopes,!0,this.oidcDefaultScopes),function(e,t){e.set("code",t)}(t,e.code),Do(t,this.config.libraryInfo),zo(t,this.config.telemetry.application),ti(t),this.serverTelemetryManager&&!Ui(this.config)&&ei(t,this.serverTelemetryManager),e.codeVerifier&&function(e,t){e.set("code_verifier",t)}(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&jo(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;$o(t,await ji(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Jo(t,r.assertionType)}if(Wo(t,"authorization_code"),Vo(t),e.authenticationScheme===le.POP){const r=new Li(this.cryptoUtils,this.performanceClient);let n;n=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await xr(r.generateCnf.bind(r),_r,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Yo(t,n)}else if(e.authenticationScheme===le.SSH){if(!e.sshJwk)throw ar(gr);Zo(t,e.sshJwk)}let r;if((!cr.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Lo(t,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{const t=dn(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${t.uid}.${t.utid}`,type:Ki}}catch(t){this.logger.verbose("0wznt3",e.correlationId)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case Ki:try{Uo(t,un(r.credential))}catch(t){this.logger.verbose("1qhtee",e.correlationId)}break;case Bi:No(t,r.credential)}return e.embeddedClientId&&ri(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&Qo(t,e.extraParameters),!e.enableSpaAuthorizationCode||e.extraParameters&&e.extraParameters[Ao]||Qo(t,{[Ao]:"1"}),Eo(t,e.correlationId,this.performanceClient),wo(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&function(e,t){e.set("post_logout_redirect_uri",t)}(t,e.postLogoutRedirectUri),e.correlationId&&Fo(t,e.correlationId),e.idTokenHint&&function(e,t){e.set("id_token_hint",t)}(t,e.idTokenHint),e.state&&Ko(t,e.state),e.logoutHint&&function(e,t){e.set("logout_hint",t)}(t,e.logoutHint),e.extraQueryParameters&&Qo(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&Go(t),wo(t)}async updateTokenEndpointAuthority(e,t){const r=`https://${e}/${this.authority.tenant}/`,n=await Xi(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=n}}class Zi{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||"",this.wrapperVer=e.wrapperVer||"",this.telemetryCacheKey=ce+"-"+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${he}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);const n=t.join(he),o=[e,this.getRegionDiscoveryFields()].join(he);return[ae,o,n].join("|")}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Zi.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(he),n=e.errors.slice(0,t).join(he),o=e.errors.length,i=[o,t<o?"1":"0"].join(he);return[ae,e.cacheHits,r,n,i].join("|")}cacheFailedRequest(e){const r=this.getLastRequests();r.errors.length>=50&&(r.failedRequests.shift(),r.failedRequests.shift(),r.errors.shift()),r.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof t?e.subError?r.errors.push(e.subError):e.errorCode?r.errors.push(e.errorCode):r.errors.push(e.toString()):r.errors.push(e.toString()):r.errors.push("unknown_error"),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey,this.correlationId)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=Zi.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,n=0;const o=e.errors.length;for(t=0;t<o;t++){const o=e.failedRequests[2*t]||"",i=e.failedRequests[2*t+1]||"",s=e.errors[t]||"";if(n+=o.toString().length+i.toString().length+s.length+3,!(n<330))break;r+=1}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||""),e.push(this.regionSource||""),e.push(this.regionOutcome||""),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){const{skus:t,libraryName:r,libraryVersion:n,extensionName:o,extensionVersion:i}=e,s=new Map([[0,[r,n]],[2,[o,i]]]);let a=[];if(t?.length){if(a=t.split(","),a.length<4)return t}else a=Array.from({length:4},(()=>"|"));return s.forEach(((e,t)=>{2===e.length&&e[0]?.length&&e[1]?.length&&function(e){const{skuArr:t,index:r,skuName:n,skuVersion:o}=e;r>=t.length||(t[r]=[n,o].join("|"))}({skuArr:a,index:t,skuName:e[0],skuVersion:e[1]})})),a.join(",")}(e)}}class es{constructor(e,t,r,n,o,i,s,a,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=i,this.platformAuthProvider=c,this.correlationId=a,this.logger=n.clone(st,pi),this.performanceClient=s}}function ts(e,t,r,n){r.verbose("0bd1la",n);const o=e||t||"";return pr.getAbsoluteUrl(o,ai())}function rs(e,t,r,n,o,i){o.verbose("1p12tq",r);const s={clientId:t,correlationId:r,apiId:e,forceRefresh:!1,wrapperSKU:n.getWrapperMetadata()[0],wrapperVer:n.getWrapperMetadata()[1]};return new Zi(s,n)}async function ns(e,t,r,n,o,i,s,a,c){const h=a&&a.hasOwnProperty("instance_aware")?a.instance_aware:void 0,l={protocolMode:e.system.protocolMode,OIDCOptions:e.auth.OIDCOptions,knownAuthorities:e.auth.knownAuthorities,cloudDiscoveryMetadata:e.auth.cloudDiscoveryMetadata,authorityMetadata:e.auth.authorityMetadata},d=i||e.auth.authority,u=h?.length?"true"===h:e.auth.instanceAware,g=c&&u?e.auth.authority.replace(pr.getDomainFromUrl(d),c.environment):d,p=Yr.generateAuthority(g,s||e.auth.azureCloudOptions),m=await xr(Xi,"authorityFactoryCreateDiscoveredInstance",o,r,t)(p,e.system.networkClient,n,l,o,t,r);if(c&&!m.isAlias(c.environment))throw ar("authority_mismatch");return m}async function os(e,t,r,n,o){if(o)try{e.removeAccount(o,n),r.verbose("0s4z6h",n)}catch(e){r.error("0mgg1d",n)}else try{r.verbose("0zj631",n),e.clear(n),await t.clearKeystore(n)}catch(e){r.error("12ih0c",n)}}async function is(e,t,r,n,o){const i=e.authority||t.auth.authority,s=[...e&&e.scopes||[]],a={...e,correlationId:e.correlationId,authority:i,scopes:s};if(a.authenticationScheme){if(a.authenticationScheme===le.SSH){if(!e.sshJwk)throw ar(gr);if(!e.sshKid)throw ar("missing_ssh_kid")}n.verbose("1ecmns",o)}else a.authenticationScheme=le.BEARER,n.verbose("1l4fwv",o);return a}async function ss(e,t,r,n,o){const i=await xr(is,fe,o,n,e.correlationId)(e,r,n,o,e.correlationId);return{...e,...i,account:t,forceRefresh:e.forceRefresh||!1}}function as(e,t){let r;const n=e.httpMethod;if(t===kr){if(n&&n!==M)throw ar("invalid_request_method_for_EAR");r=M}else r=n||"GET";return r}class cs extends es{initializeLogoutRequest(e){this.logger.verbose("0546u4",this.correlationId);const t={correlationId:this.correlationId,...e};if(e)if(e.logoutHint)this.logger.verbose("12k4l4",this.correlationId);else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("0st5di",this.correlationId),t.logoutHint=r)}else this.logger.verbose("0pdtc3",this.correlationId);else this.logger.verbose("07ndze",this.correlationId);return e&&null===e.postLogoutRedirectUri?this.logger.verbose("0ljv63",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("1vamm6",t.correlationId),t.postLogoutRedirectUri=pr.getAbsoluteUrl(e.postLogoutRedirectUri,ai())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("15m5g7",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("1f4xlz",t.correlationId),t.postLogoutRedirectUri=pr.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,ai())):(this.logger.verbose("17s5rf",t.correlationId),t.postLogoutRedirectUri=pr.getAbsoluteUrl(ai(),ai())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("0mvp54",this.correlationId)}else this.logger.verbose("1e7bdp",this.correlationId);return null}async createAuthCodeClient(e){const t=await xr(this.getClientConfiguration.bind(this),ve,this.logger,this.performanceClient,this.correlationId)(e);return new Yi(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:n,requestExtraQueryParameters:o,account:i}=e,s=e.authority||await xr(ns,ge,this.logger,this.performanceClient,this.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,n,o,i),a=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:a.loggerCallback,piiLoggingEnabled:a.piiLoggingEnabled,logLevel:a.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:st,version:pi,cpu:"",os:""},telemetry:this.config.telemetry}}}async function hs(e,t,r,n,i,s,a,c){const h=ts(e.redirectUri,r.auth.redirectUri,s,c),l={interactionType:t},d=function(e,t,r){const n=function(e,t){if(!e)throw o(f);const r={id:e.createNewGuid()};t&&(r.meta=t);const n=JSON.stringify(r);return e.base64Encode(n)}(e,r);return t?`${n}|${t}`:n}(n,e&&e.state||"",l),u={...await xr(is,fe,s,a,c)({...e,correlationId:c},r,a,s,c),redirectUri:h,state:d,nonce:e.nonce||$t(),responseMode:r.auth.OIDCOptions.responseMode},g={...u,httpMethod:as(u,r.system.protocolMode)};if(e.loginHint||e.sid)return g;const p=e.account||i.getActiveAccount(c);return p&&(s.verbose("1eqlb3",c),s.verbosePii("0tf99t",c),g.account=p),g}function ls(e,t,r,n){const o=yo(e);if(!o)throw fo(e)?(r.error("13pl0s",n),r.errorPii("1097vx",n),He("hash_does_not_contain_known_properties")):(r.error("18h0l1",n),He("hash_empty_error"));return o}function ds(e,t){const r=wo(t);return pr.appendQueryString(e.authorizationEndpoint,r)}function us(e,t){if(!e.state||!t)throw e.state?o(l,"Cached State"):o(l,"Server State");let r,n;try{r=decodeURIComponent(e.state)}catch(t){throw o(h,e.state)}try{n=decodeURIComponent(t)}catch(t){throw o(h,e.state)}if(r!==n)throw o("state_mismatch");if(e.error||e.error_description||e.suberror){const t=function(e){const t="code=",r=e.error_uri?.lastIndexOf(t);return r&&r>=0?e.error_uri?.substring(r+5):void 0}(e);if(hn(e.error,e.error_description,e.suberror))throw new cn(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",t);throw new Hi(e.error||"",e.error_description,e.suberror,t)}}class gs{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}async handleCodeResponse(e,t,r){let n;try{n=function(e,t){if(us(e,t),!e.code)throw o("authorization_code_missing_from_server_response");return e}(e,t.state)}catch(e){throw e instanceof Hi&&e.subError===je?He(je):e}return xr(this.handleCodeResponseFromServer.bind(this),Sr,this.logger,this.performanceClient,t.correlationId)(n,t,r)}async handleCodeResponseFromServer(e,t,r,n=!0){if(this.logger.trace("0mf2hb",t.correlationId),this.authCodeRequest.code=e.code,n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await xr(this.authModule.acquireToken.bind(this.authModule),"authClientAcquireToken",this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,r,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ki}:e.loginHint?{credential:e.loginHint,type:Bi}:null}}class ps extends t{constructor(e,t,r){super(e,t||Ne(e)),Object.setPrototypeOf(this,ps.prototype),this.name="NativeAuthError",this.ext=r}}function ms(e){if(e.ext&&e.ext.status&&("PERSISTENT_ERROR"===e.ext.status||"DISABLED"===e.ext.status))return!0;if(e.ext&&e.ext.error&&-2147186943===e.ext.error)return!0;switch(e.errorCode){case"ContentError":case"PageException":return!0;default:return!1}}function fs(e,t,r){if(r&&r.status)switch(r.status){case"ACCOUNT_UNAVAILABLE":return ln("native_account_unavailable",Ne(e));case"USER_INTERACTION_REQUIRED":return new cn(e,t);case"USER_CANCEL":return He(je);case"NO_NETWORK":return He(Ve);case"UX_NOT_ALLOWED":return ln(nn)}return new ps(e,t,r)}class ys{constructor(e,t){this.config=Ni(e),this.logger=new Ti(this.config.loggerOptions,Sn,_n),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireCachedToken(e){let t="0";if(e.forceRefresh||!cr.isEmptyObj(e.claims))throw this.setCacheOutcome("1",e.correlationId),o(y);if(!e.account)throw o(g);const r=e.account.tenantId||function(e){const t=new pr(e).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case B:case j:case $:return;default:return r}}(e.authority),n=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,n,r);if(!i)throw this.setCacheOutcome("2",e.correlationId),o(y);if(Kr(i.cachedAt)||Dr(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome("3",e.correlationId),o(y);i.refreshOn&&Dr(i.refreshOn,0)&&(t="4");const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,n,r),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s,e.correlationId)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await xr(this.generateResultFromCacheRecord.bind(this),"silentFlowClientGenerateResultFromCacheRecord",this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info("09ingz",t)}async generateResultFromCacheRecord(e,t){let r;if(e.idToken&&(r=Mr(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const e=r?.auth_time;if(!e)throw o(d);Ur(e,t.maxAge)}return Di.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,this.performanceClient,r)}}class ws extends cs{async acquireToken(e){const t=rs(61,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=await xr(this.getClientConfiguration.bind(this),ve,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),n=new ys(r,this.performanceClient);this.logger.verbose("0wa871",this.correlationId);try{const t=(await xr(n.acquireCachedToken.bind(n),"silentFlowClientAcquireCachedToken",this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof Ue&&e.errorCode===Qe&&this.logger.verbose("06wena",this.correlationId),e}}logout(e){this.logger.verbose("1rkurh",this.correlationId);const t=this.initializeLogoutRequest(e);return os(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account)}}class Is extends es{constructor(e,t,r,n,o,i,s,a,c,h,l,d){super(e,t,r,n,o,i,a,d,c),this.apiId=s,this.accountId=h,this.platformAuthProvider=c,this.nativeStorageManager=l,this.silentCacheClient=new ws(e,this.nativeStorageManager,r,n,o,i,a,d,c);const u=this.platformAuthProvider.getExtensionName();this.skus=Zi.makeExtraSkuString({libraryName:st,libraryVersion:pi,extensionName:u,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[To]:this.skus}}async acquireToken(e,t){this.logger.trace("03qeos",this.correlationId);const r=this.performanceClient.startMeasurement(pe,e.correlationId),n=Hr(),o=rs(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const i=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,i);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){if(1===t)throw this.logger.info("0eitbc",this.correlationId),e;this.logger.info("0957j1",this.correlationId)}const s=await this.platformAuthProvider.sendMessage(i);return await this.handleNativeResponse(s,i,n).then((e=>(r.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),o.clearNativeBrokerErrorCode(),e))).catch((e=>{throw r.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e}))}catch(e){throw e instanceof ps&&o.setNativeBrokerErrorCode(e.errorCode),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:Tn.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("1ndf3e",this.correlationId),o(m);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw o(m);try{const e=this.createSilentCacheRequest(t,r),n=await this.silentCacheClient.acquireToken(e),o={...r,idTokenClaims:n?.idTokenClaims,idToken:n?.idToken};return{...n,account:o}}catch(e){throw e}}async acquireTokenRedirect(e,t,r){this.logger.trace("0luikq",this.correlationId);const n=await this.initializeNativeRequest(e),o=r?.navigateToLoginRequestUrl??!0;try{await this.platformAuthProvider.sendMessage(n)}catch(e){if(e instanceof ps&&(rs(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).setNativeBrokerErrorCode(e.errorCode),ms(e)))throw e}this.browserStorage.setTemporaryCache(vt,JSON.stringify(n),!0);const i={apiId:At,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=o?window.location.href:ts(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId);t.end({success:!0}),await this.navigationClient.navigateExternal(s,i)}async handleRedirectPromise(e,t){if(this.logger.trace("1c5lhw",this.correlationId),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",this.correlationId),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("0a6zjb",this.correlationId),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:n,...o}=r;n&&this.logger.verbose("0ac34v",this.correlationId),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(vt));const i=Hr();try{this.logger.verbose("003x5a",this.correlationId);const e=await this.platformAuthProvider.sendMessage(o),t=await this.handleNativeResponse(e,o,i);return rs(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).clearNativeBrokerErrorCode(),t}catch(e){throw e}}logout(){return this.logger.trace("0u2sjm",this.correlationId),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("1bojln",this.correlationId);const n=Mr(e.id_token,rt),o=this.createHomeAccountIdentifier(e,n),i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("1ub1in",this.correlationId);else if(o!==i&&e.account.id!==t.accountId)throw fs("user_switch");const s=await ns(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t.authority),a=zi(this.browserStorage,s,o,rt,this.correlationId,n,e.client_info,void 0,n.tid,void 0,e.account.id);e.expires_in=Number(e.expires_in);const c=await this.generateAuthenticationResult(e,t,n,a,s.canonicalAuthority,r);return await this.cacheAccount(a,Nr(n)),await this.cacheNativeTokens(e,t,o,n,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return In(e.client_info||"",0,this.logger,this.browserCrypto,this.correlationId,t)}generateScopes(e,t){return t?Tn.fromString(t):Tn.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===le.POP&&t.signPopToken){if(e.shr)return this.logger.trace("0coqhu",this.correlationId),e.shr;const r=new Li(this.browserCrypto,this.performanceClient),n={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce,correlationId:this.correlationId};if(!t.keyId)throw o(w);return r.signPopToken(e.access_token,t.keyId,n)}return e.access_token}async generateAuthenticationResult(e,t,r,n,o,i){const s=this.addTelemetryFromNativeResponse(e.properties.MATS),a=this.generateScopes(t.scope,e.scope),c=e.account.properties||{},h=c.UID||r.oid||r.sub||"",l=c.TenantId||r.tid||"",d=mn(yn(n),void 0,r,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const u=await this.generatePopAccessToken(e,t),g=t.tokenType===le.POP?le.POP:le.BEARER;return{authority:o,uniqueId:h,tenantId:l,scopes:a.asArray(),account:d,idToken:e.id_token,idTokenClaims:r,accessToken:u,fromCache:!!s&&this.isResponseFromCache(s),expiresOn:Fr(i+e.expires_in),tokenType:g,correlationId:this.correlationId,state:e.state,fromPlatformBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId,t,this.apiId),this.browserStorage.removeAccountContext(yn(e),this.correlationId)}cacheNativeTokens(e,t,r,n,o,i,s){const a=Br(r,t.authority,e.id_token||"",t.clientId,n.tid||""),c=s+(t.tokenType===le.POP?240:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),h=this.generateScopes(e.scope,t.scope),l={idToken:a,accessToken:jr(r,t.authority,o,t.clientId,n.tid||i,h.printScopes(),c,0,rt,void 0,t.tokenType,void 0,t.keyId)};return this.nativeStorageManager.saveCacheRecord(l,this.correlationId,Nr(n),this.apiId,t.storeInCache)}getExpiresInValue(e,t){return e===le.POP?240:("string"==typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(e){this.logger.error("0b3l57",this.correlationId)}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("1okqev",this.correlationId),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("04j6wj",this.correlationId);const t=await this.getCanonicalAuthority(e),{scopes:r,...n}=e,o=new Tn(r||[]);o.appendScopes(N);const i={...n,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:ts(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraParameters},extendedExpiryToken:!1,keyId:e.popKid};if(i.signPopToken&&e.popKid)throw He("invalid_pop_token_request");if(this.handleExtraBrokerParams(i),i.extraParameters=i.extraParameters||{},i.extraParameters.telemetry="MATS",e.authenticationScheme===le.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce,correlationId:this.correlationId},r=new Li(this.browserCrypto,this.performanceClient);let n;if(i.keyId)n=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:i.keyId})),i.signPopToken=!1;else{const e=await xr(r.generateCnf.bind(r),_r,this.logger,this.performanceClient,this.correlationId)(t,this.logger);n=e.reqCnfString,i.keyId=e.kid,i.signPopToken=!0}i.reqCnf=n}return this.addRequestSKUs(i),i}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority,{azureCloudOptions:r,account:n}=e;n&&await ns(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t,r,void 0,n);const o=new pr(t);return o.validateAsUri(),o}getPrompt(e){switch(this.apiId){case 863:case 61:return this.logger.trace("1hiwaz",this.correlationId),G}if(e)switch(e){case G:case V:case W:return this.logger.trace("1ynje4",this.correlationId),e;default:throw this.logger.trace("0nkr6q",this.correlationId),He("native_prompt_not_supported")}else this.logger.trace("1qlu04",this.correlationId)}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(So)&&e.extraParameters.hasOwnProperty(_o)&&e.extraParameters.hasOwnProperty(Co);if(!e.embeddedClientId&&!t)return;let r="";const n=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[_o],r=e.extraParameters[Co]),e.extraParameters={child_client_id:r,child_redirect_uri:n},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:n},e.correlationId)}}async function Cs(e,t,r,n,o){const i=function(e,t,r,n){const o=t.correlationId,i=new Map;if(xo(i,t.embeddedClientId||t.extraQueryParameters?.[Co]||e.clientId),Oo(i,[...t.scopes||[],...t.extraScopesToConsent||[]],!0,e.authority.options.OIDCOptions?.defaultScopes),qo(i,t.redirectUri),Fo(i,o),function(e,t){e.set("response_mode",t||X)}(i,t.responseMode),Vo(i),t.prompt&&(function(e,t){e.set("prompt",t)}(i,t.prompt),n?.addFields({prompt:t.prompt},o)),t.domainHint&&(function(e,t){e.set("domain_hint",t)}(i,t.domainHint),n?.addFields({domainHintFromRequest:!0},o)),"select_account"!==t.prompt)if(t.sid&&t.prompt===G)r.verbose("1tvqyx",t.correlationId),Ho(i,t.sid),n?.addFields({sidFromRequest:!0},o);else if(t.account){const e=(s=t.account,s.idTokenClaims?.sid||null);let a=function(e){return e.loginHint||e.idTokenClaims?.login_hint||null}(t.account);if(a&&t.domainHint&&(r.warning("0wkg3v",t.correlationId),a=null),a){r.verbose("1eyfsw",t.correlationId),Mo(i,a),n?.addFields({loginHintFromClaim:!0},o);try{Uo(i,un(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}else if(e&&t.prompt===G){r.verbose("1rmd8s",t.correlationId),Ho(i,e),n?.addFields({sidFromClaim:!0},o);try{Uo(i,un(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}else if(t.loginHint)r.verbose("0y3007",t.correlationId),Mo(i,t.loginHint),No(i,t.loginHint),n?.addFields({loginHintFromRequest:!0},o);else if(t.account.username){r.verbose("02f507",t.correlationId),Mo(i,t.account.username),n?.addFields({loginHintFromUpn:!0},o);try{Uo(i,un(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}}else t.loginHint&&(r.verbose("0g01ey",t.correlationId),Mo(i,t.loginHint),No(i,t.loginHint),n?.addFields({loginHintFromRequest:!0},o));else r.verbose("169k9v",t.correlationId);var s;return t.nonce&&function(e,t){e.set("nonce",t)}(i,t.nonce),t.state&&Ko(i,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&Lo(i,t.claims,e.clientCapabilities),t.embeddedClientId&&ri(i,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(Po)||Go(i),i}({...e.auth,authority:t},r,n,o);if(Do(i,{sku:st,version:pi,os:"",cpu:""}),e.system.protocolMode!==vr&&zo(i,e.telemetry.application),r.platformBroker&&(function(e){e.set("nativebroker","1")}(i),r.authenticationScheme===le.POP)){const e=new nr(n,o),t=new Li(e,o);let s;s=r.popKid?e.encodeKid(r.popKid):(await xr(t.generateCnf.bind(t),_r,n,o,r.correlationId)(r,n)).reqCnfString,Yo(i,s)}return Eo(i,r.correlationId,o),i}async function vs(e,t,r,n,o){if(!r.codeChallenge)throw ar(dr);const i=await xr(Cs,"getStandardParams",n,o,r.correlationId)(e,t,r,n,o);return Ro(i,Q),Bo(i,r.codeChallenge,R),Qo(i,{...r.extraQueryParameters,...r.extraParameters}),ds(t,i)}async function ks(e,t,r,n,o,i){if(!n.earJwk)throw He(Fe);const s=await Cs(t,r,n,o,i);Ro(s,"id_token token refresh_token"),function(e,t){e.set("ear_jwk",encodeURIComponent(t)),e.set("ear_jwe_crypto","eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}(s,n.earJwk),Bo(s,n.codeChallenge,R),Qo(s,{...n.extraParameters});const a=new Map;return Qo(a,n.extraQueryParameters||{}),Fo(a,n.correlationId),As(e,ds(r,a),s)}async function bs(e,t,r,n,o,i){const s=await Cs(t,r,n,o,i);Ro(s,Q),Bo(s,n.codeChallenge,n.codeChallengeMethod||R),Qo(s,{...n.extraParameters});const a=new Map;return Qo(a,n.extraQueryParameters||{}),Fo(a,n.correlationId),As(e,ds(r,a),s)}function As(e,t,r){const n=e.createElement("form");return n.method="post",n.action=t,r.forEach(((t,r)=>{const o=e.createElement("input");o.hidden=!0,o.name=r,o.value=t,n.appendChild(o)})),e.body.appendChild(n),n}async function Ts(e,t,r,n,o,i,s,a,c,h){if(a.verbose("11qcow",e.correlationId),!h)throw He(Ye);const l=new nr(a,c),d=new Is(n,o,l,a,s,n.system.navigationClient,r,c,h,t,i,e.correlationId),{userRequestState:u}=po(l.base64Decode,e.state);return xr(d.acquireToken.bind(d),pe,a,c,e.correlationId)({...e,state:u,prompt:void 0})}async function Ss(e,t,r,n,o,i,s,a,c,h,l,d){if($i.removeThrottle(s,o.auth.clientId,e),t.accountId)return xr(Ts,Ae,h,l,e.correlationId)(e,t.accountId,n,o,s,a,c,h,l,d);const u={...e,code:t.code||"",codeVerifier:r},g=new gs(i,s,u,h,l);return await xr(g.handleCodeResponse.bind(g),"handleCodeResponse",h,l,e.correlationId)(t,e,n)}async function _s(e,t,r,n,o,i,s,a,c,h,l){if($i.removeThrottle(i,n.auth.clientId,e),us(t,e.state),!t.ear_jwe)throw He("ear_jwe_empty");if(!e.earJwk)throw He(Fe);const d=JSON.parse(await xr(Vt,"decryptEarResponse",c,h,e.correlationId)(e.earJwk,t.ear_jwe));if(d.accountId)return xr(Ts,Ae,c,h,e.correlationId)(e,d.accountId,r,n,i,s,a,c,h,l);const u=new Di(n.auth.clientId,i,new nr(c,h),c,h,null,null);u.validateTokenResponse(d,e.correlationId);const g={code:"",state:e.state,nonce:e.nonce,client_info:d.client_info,cloud_graph_host_name:d.cloud_graph_host_name,cloud_instance_host_name:d.cloud_instance_host_name,cloud_instance_name:d.cloud_instance_name,msgraph_host:d.msgraph_host};return await xr(u.handleServerTokenResponse.bind(u),Pr,c,h,e.correlationId)(d,o,Hr(),e,r,g,void 0,void 0,void 0,void 0)}async function Ps(e,t,r){const n=Or(Es,"generateCodeVerifier",t,e,r)(e,t,r);return{verifier:n,challenge:await xr(Rs,"generateCodeChallengeFromVerifier",t,e,r)(n,e,t,r)}}function Es(e,t,r){try{const n=new Uint8Array(32);return Or(Bt,"getRandomValues",t,e,r)(n),xe(n)}catch(e){throw He(Le)}}async function Rs(e,t,r,n){try{const o=await xr(Kt,"sha256Digest",r,t,n)(e);return xe(new Uint8Array(o))}catch(e){throw He(Le)}}const Os={sendGetRequestAsync:()=>Promise.reject(o(I)),sendPostRequestAsync:()=>Promise.reject(o(I))};class xs{navigateInternal(e,t){return xs.defaultNavigateWindow(e,t)}navigateExternal(e,t){return xs.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(((e,r)=>{setTimeout((()=>{r(He(tt,"failed_to_redirect"))}),t.timeout)}))}}class qs{async sendGetRequestAsync(e,t){let r,n={},o=0;const i=Ms(t);try{r=await fetch(e,{method:"GET",headers:i})}catch(e){throw Wi(He(window.navigator.onLine?"get_request_failed":Ve),void 0,void 0,e)}n=Ns(r.headers);try{return o=r.status,{headers:n,body:await r.json(),status:o}}catch(e){throw Wi(He(Ge),o,n,e)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",n=Ms(t);let o,i=0,s={};try{o=await fetch(e,{method:"POST",headers:n,body:r})}catch(e){throw Wi(He(window.navigator.onLine?"post_request_failed":Ve),void 0,void 0,e)}s=Ns(o.headers);try{return i=o.status,{headers:s,body:await o.json(),status:i}}catch(e){throw Wi(He(Ge),i,s,e)}}}function Ms(e){try{const t=new Headers;if(!e||!e.headers)return t;const r=e.headers;return Object.entries(r).forEach((([e,r])=>{t.append(e,r)})),t}catch(e){throw Wi(He("failed_to_build_headers"),void 0,void 0,e)}}function Ns(e){try{const t={};return e.forEach(((e,r)=>{t[r]=e})),t}catch(e){throw He("failed_to_parse_headers")}}const Us="unexpected_error";class Hs{constructor(e,t,r,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement("nativeMessageHandlerHandshake"),this.platformAuthType="PlatformAuthExtensionHandler"}async sendMessage(e){this.logger.trace("0on4p2",e.correlationId);const t={method:"GetToken",request:e},r={channel:at,extensionId:this.extensionId,responseId:$t(),body:t};this.logger.trace("1qadfi",e.correlationId),this.logger.tracePii("1xm533",e.correlationId),this.messageChannel.port1.postMessage(r);const n=await new Promise(((e,t)=>{this.resolvers.set(r.responseId,{resolve:e,reject:t})}));return this.validatePlatformBrokerResponse(n)}static async createProvider(e,t,r,n){e.trace("15zfnw",n);try{const o=new Hs(e,t,r,ct);return await o.sendHandshakeRequest(n),o}catch(o){const i=new Hs(e,t,r);return await i.sendHandshakeRequest(n),i}}async sendHandshakeRequest(e){this.logger.trace("1dpg9o",e),window.addEventListener("message",this.windowListener,!1);const t={channel:at,extensionId:this.extensionId,responseId:$t(),body:{method:lt}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(t,window.origin,[this.messageChannel.port2]),new Promise(((e,r)=>{this.handshakeResolvers.set(t.responseId,{resolve:e,reject:r}),this.timeoutId=window.setTimeout((()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(He("native_handshake_timeout")),this.handshakeResolvers.delete(t.responseId)}),this.handshakeTimeoutMs)}))}onWindowMessage(e){const t=gi();if(this.logger.trace("0jpn5u",t),e.source!==window)return;const r=e.data;if(r.channel&&r.channel===at&&(!r.extensionId||r.extensionId===this.extensionId)&&r.body.method===lt){const e=this.handshakeResolvers.get(r.responseId);if(!e)return void this.logger.trace("07buhm",t);this.logger.verbose(r.extensionId?"0xrkug":"No extension installed",t),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject(He("native_extension_not_installed"))}}onChannelMessage(e){const t=gi();this.logger.trace("1py8yf",t);const n=e.data,o=this.resolvers.get(n.responseId),i=this.handshakeResolvers.get(n.responseId);try{const e=n.body.method;if("Response"===e){if(!o)return;const e=n.body.response;if(this.logger.trace("19hpgm",t),this.logger.tracePii("179a24",t),"Success"!==e.status)o.reject(fs(e.code,e.description,e.ext));else{if(!e.result)throw r(Us,"Event does not contain result.");e.result.code&&e.result.description?o.reject(fs(e.result.code,e.result.description,e.result.ext)):o.resolve(e.result)}this.resolvers.delete(n.responseId)}else if("HandshakeResponse"===e){if(!i)return void this.logger.trace("082qnt",t);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=n.extensionId,this.extensionVersion=n.body.version,this.logger.verbose("0yf5ib",t),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(n.responseId)}}catch(e){this.logger.error("0xf978",t),this.logger.errorPii("04i99o",t),this.logger.errorPii("0xdvsy",t),o?o.reject(e):i&&i.reject(e)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw r(Us,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===ct?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class Ls{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType="PlatformAuthDOMHandler"}static async createProvider(e,t,r){if(e.trace("12mj4a",r),window.navigator?.platformAuthentication){const n=await window.navigator.platformAuthentication.getSupportedContracts(ht);if(n?.includes("get-token-and-sign-out"))return e.trace("1h5q1r",r),new Ls(e,t,r)}}getExtensionId(){return ht}getExtensionVersion(){return""}getExtensionName(){return"DOM API"}async sendMessage(e){this.logger.trace("02bcil",e.correlationId);try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r,e.correlationId)}catch(t){throw this.logger.error("11im7g",e.correlationId),t}}initializePlatformDOMRequest(e){this.logger.trace("15d6yv",e.correlationId);const{accountId:t,clientId:r,authority:n,scope:o,redirectUri:i,correlationId:s,state:a,storeInCache:c,embeddedClientId:h,extraParameters:l,...d}=e,u=this.getDOMExtraParams(d);return{accountId:t,brokerId:this.getExtensionId(),authority:n,clientId:r,correlationId:s||this.correlationId,extraParameters:{...l,...u},isSecurityTokenService:!1,redirectUri:i,scope:o,state:a,storeInCache:c,embeddedClientId:h}}validatePlatformBrokerResponse(e,t){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace("0h4vei",t),this.convertToPlatformBrokerResponse(e,t);if(e.hasOwnProperty("error")){const r=e;if(!1===r.isSuccess&&r.error&&r.error.code)throw this.logger.trace("0g92vm",t),fs(r.error.code,r.error.description,{error:parseInt(r.error.errorCode),protocol_error:r.error.protocolError,status:r.error.status,properties:r.error.properties})}}throw r(Us,"Response missing expected properties.")}convertToPlatformBrokerResponse(e,t){return this.logger.trace("14913t",t),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce(((e,[t,r])=>(e[t]=String(r),e)),{})}}}function Fs(e,t,r,n,o){if(t.trace("0uko3r",r),!e.system.allowPlatformBroker)return t.trace("04hozs",r),!1;if(!n)return t.trace("0kvv1r",r),!1;if(o)switch(o){case le.BEARER:case le.POP:return t.trace("18tev1",r),!0;default:return t.trace("1dd2nh",r),!1}return!0}class Ds extends cs{constructor(e,t,r,n,o,i,s,a,c,h){super(e,t,r,n,o,i,s,c,h),this.nativeStorage=a,this.eventHandler=o}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||N,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:!this.config.system.navigatePopups},this.correlationId),this.config.system.navigatePopups){const n={...e,httpMethod:as(e,this.config.system.protocolMode)};return this.logger.verbose("1f9ok3",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(n,r,t)}return this.logger.verbose("162h4u",this.correlationId),this.acquireTokenPopupAsync(e,r,t)}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("068rup",this.correlationId);const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},n=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.navigatePopups?(this.logger.verbose("1a28da",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,n,o)):(this.logger.verbose("1phd8u",this.correlationId),this.logoutPopupAsync(t,r,n,o))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("1g77pg",this.correlationId);const n=await xr(hs,ke,this.logger,this.performanceClient,this.correlationId)(e,_t.Popup,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.popup&&ui(n.authority);const o=Fs(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);return n.platformBroker=o,this.config.system.protocolMode===kr?this.executeEarFlow(n,t,r):this.executeCodeFlow(n,t,r)}async executeCodeFlow(e,r,n){const o=e.correlationId,i=rs(Tt,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=n||await xr(Ps,_e,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o),a={...e,codeChallenge:s.challenge};try{const t=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,o)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account});if(a.httpMethod===M)return await this.executeCodeFlowWithPost(a,r,t,s.verifier);{const n=await xr(vs,Tr,this.logger,this.performanceClient,o)(this.config,t.authority,a,this.logger,this.performanceClient),i=this.initiateAuthRequest(n,r);this.eventHandler.emitEvent(co,o,_t.Popup,{popupWindow:i},null);const c=await si(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),h=Or(ls,Se,this.logger,this.performanceClient,this.correlationId)(c,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return await xr(Ss,Te,this.logger,this.performanceClient,o)(e,h,s.verifier,Tt,this.config,t,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(e){throw r.popup?.close(),e instanceof t&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),e}}async executeEarFlow(e,t,r){const{correlationId:n,authority:o,azureCloudOptions:i,extraQueryParameters:s,account:a}=e,c=await xr(ns,ge,this.logger,this.performanceClient,n)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,o,i,s,a),h=await xr(Wt,Re,this.logger,this.performanceClient,n)(),l=r||await xr(Ps,_e,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),d={...e,earJwk:h,codeChallenge:l.challenge},u=t.popup||this.openPopup("about:blank",t);(await ks(u.document,this.config,c,d,this.logger,this.performanceClient)).submit();const g=await xr(si,Ie,this.logger,this.performanceClient,n)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,d),p=Or(ls,Se,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);if(!p.ear_jwe&&p.code){const t=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,n)({serverTelemetryManager:rs(Tt,this.config.auth.clientId,n,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:c});return xr(Ss,Te,this.logger,this.performanceClient,n)(d,p,l.verifier,Tt,this.config,t,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}return xr(_s,be,this.logger,this.performanceClient,n)(d,p,Tt,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,n){const o=e.correlationId,i=await xr(ns,ge,this.logger,this.performanceClient,o)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger),s=t.popup||this.openPopup("about:blank",t);(await bs(s.document,this.config,i,e,this.logger,this.performanceClient)).submit();const a=await xr(si,Ie,this.logger,this.performanceClient,o)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),c=Or(ls,Se,this.logger,this.performanceClient,this.correlationId)(a,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return xr(Ss,Te,this.logger,this.performanceClient,o)(e,c,n,Tt,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,r,n,o){this.logger.verbose("0b7yrk",this.correlationId),this.eventHandler.emitEvent(ho,this.correlationId,_t.Popup,e);const i=rs(962,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{await os(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account);const t=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:n,account:e.account||void 0});try{t.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&t.authority.protocolMode===vr){if(this.eventHandler.emitEvent(lo,e.correlationId,_t.Popup,e),o){const e={apiId:962,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=pr.getAbsoluteUrl(o,ai());await this.navigationClient.navigateInternal(t,e)}return void r.popup?.close()}}const s=t.getLogoutUri(e);this.eventHandler.emitEvent(lo,e.correlationId,_t.Popup,e);const a=this.openPopup(s,r);if(this.eventHandler.emitEvent(co,e.correlationId,_t.Popup,{popupWindow:a},null),await si(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e).catch((()=>{})),o){const e={apiId:962,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=pr.getAbsoluteUrl(o,ai());this.logger.verbose("0qcur2",this.correlationId),this.logger.verbosePii("0oj7lk",this.correlationId),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("03zgcf",this.correlationId)}catch(e){throw r.popup?.close(),e instanceof t&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),this.eventHandler.emitEvent(uo,this.correlationId,_t.Popup,null,e),this.eventHandler.emitEvent(go,this.correlationId,_t.Popup),e}this.eventHandler.emitEvent(go,this.correlationId,_t.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("1kcr9k",this.correlationId),this.openPopup(e,t);throw this.logger.error("1l7hyp",this.correlationId),He(ze)}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii("0cgeo7",this.correlationId),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("0c2awd",this.correlationId),r=this.openSizedPopup(e,t)),!r)throw He("empty_window_error");return r.focus&&r.focus(),this.currentWindow=r,r}catch(e){throw this.logger.error("0dxfb9",this.correlationId),He("popup_window_error")}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:n}){const o=n.screenLeft?n.screenLeft:n.screenX,i=n.screenTop?n.screenTop:n.screenY,s=n.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=n.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=r.popupSize?.width,h=r.popupSize?.height,l=r.popupPosition?.top,d=r.popupPosition?.left;return(!c||c<0||c>s)&&(this.logger.verbose("08vfmo",this.correlationId),c=483),(!h||h<0||h>a)&&(this.logger.verbose("09cxa0",this.correlationId),h=600),(!l||l<0||l>a)&&(this.logger.verbose("1qh4wo",this.correlationId),l=Math.max(0,a/2-300+i)),(!d||d<0||d>s)&&(this.logger.verbose("1sz3en",this.correlationId),d=Math.max(0,s/2-241.5+o)),n.open(e,t,`width=${c}, height=${h}, top=${l}, left=${d}, scrollbars=yes`)}generatePopupName(e,t){return`${it}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${it}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}class zs extends cs{constructor(e,t,r,n,o,i,s,a,c,h){super(e,t,r,n,o,i,s,c,h),this.nativeStorage=a}async acquireToken(e){const r=await xr(hs,ke,this.logger,this.performanceClient,this.correlationId)(e,_t.Redirect,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);r.platformBroker=Fs(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);const n=e=>{e.persisted&&(this.logger.verbose("0udvtt",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),this.eventHandler.emitEvent("msal:restoreFromBFCache",this.correlationId,_t.Redirect))},o=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii("0zao0a",this.correlationId),this.browserStorage.setTemporaryCache(ft,o,!0),window.addEventListener("pageshow",n);try{this.config.system.protocolMode===kr?await this.executeEarFlow(r):await this.executeCodeFlow(r)}catch(e){throw e instanceof t&&e.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",n),e}}async executeCodeFlow(e){const r=e.correlationId,n=rs(At,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),o=await xr(Ps,_e,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),i={...e,codeChallenge:o.challenge};this.browserStorage.cacheAuthorizeRequest(i,this.correlationId,o.verifier);try{if(i.httpMethod===M)return await this.executeCodeFlowWithPost(i);{const t=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),r=await xr(vs,Tr,this.logger,this.performanceClient,e.correlationId)(this.config,t.authority,i,this.logger,this.performanceClient);return await this.initiateAuthRequest(r)}}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),e}}async executeEarFlow(e){const{correlationId:t,authority:r,azureCloudOptions:n,extraQueryParameters:o,account:i}=e,s=await xr(ns,ge,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,n,o,i),a=await xr(Wt,Re,this.logger,this.performanceClient,t)(),c=await xr(Ps,_e,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),h={...e,earJwk:a,codeChallenge:c.challenge};return this.browserStorage.cacheAuthorizeRequest(h,this.correlationId,c.verifier),(await ks(document,this.config,s,h,this.logger,this.performanceClient)).submit(),new Promise(((e,t)=>{setTimeout((()=>{t(He(tt,"failed_to_redirect"))}),this.config.system.redirectNavigationTimeout)}))}async executeCodeFlowWithPost(e){const t=e.correlationId,r=await xr(ns,ge,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger);return this.browserStorage.cacheAuthorizeRequest(e,this.correlationId),(await bs(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise(((e,t)=>{setTimeout((()=>{t(He(tt,"failed_to_redirect"))}),this.config.system.redirectNavigationTimeout)}))}async handleRedirectPromise(e,r,n,o){const i=rs(865,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=o?.navigateToLoginRequestUrl??!0;try{const[t,a]=this.getRedirectResponse(o?.hash||"");if(!t)return this.logger.info("1qmv0q",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?n.event.errorCode="no_server_response":this.logger.verbose("1eqegq",this.correlationId),null;const c=this.browserStorage.getTemporaryCache(ft,this.correlationId,!0)||"";if(Io(c)===Io(window.location.href)&&s)return this.logger.verbose("11yred",this.correlationId),c.indexOf("#")>-1&&function(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}(c),await this.handleResponse(t,e,r,i);if(!s)return this.logger.verbose("0v4sdv",this.correlationId),await this.handleResponse(t,e,r,i);if(!oi()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(yt,a,!0);const n={apiId:865,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let o=!0;if(c&&"null"!==c)this.logger.verbose("08jpy1",this.correlationId),o=await this.navigationClient.navigateInternal(c,n);else{const e=function(){const e=new pr(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}();this.browserStorage.setTemporaryCache(ft,e,!0),this.logger.warning("1dutq1",this.correlationId),o=await this.navigationClient.navigateInternal(e,n)}if(!o)return await this.handleResponse(t,e,r,i)}return null}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),e}}getRedirectResponse(e){this.logger.verbose("1c5i8m",this.correlationId);let r=e;r||(r=this.config.auth.OIDCOptions.responseMode===X?window.location.search:window.location.hash);let n=yo(r);if(n){try{!function(e,t,r){if(!e.state)throw He(Ke);const n=function(e,t){if(!t)return null;try{return po(e.base64Decode,t).libraryState.meta}catch(e){throw o(h)}}(t,e.state);if(!n)throw He(Be);if(n.interactionType!==r)throw He("state_interaction_type_mismatch")}(n,this.browserCrypto,_t.Redirect)}catch(e){return e instanceof t&&this.logger.error("0bkq6p",this.correlationId),[null,""]}return ni(window),this.logger.verbose("00uvho",this.correlationId),[n,r]}const i=this.browserStorage.getTemporaryCache(yt,this.correlationId,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(yt)),i&&(n=yo(i),n)?(this.logger.verbose("001671",this.correlationId),[n,i]):[null,""]}async handleResponse(e,t,r,n){if(!e.state)throw He(Ke);const{authority:o,azureCloudOptions:i,extraQueryParameters:s,account:a}=t;if(e.ear_jwe){const r=await xr(ns,ge,this.logger,this.performanceClient,t.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,o,i,s,a);return xr(_s,be,this.logger,this.performanceClient,t.correlationId)(t,e,At,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const c=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority});return xr(Ss,Te,this.logger,this.performanceClient,t.correlationId)(t,e,r,At,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e){if(this.logger.verbose("0yaw2e",this.correlationId),e){this.logger.infoPii("1luf83",this.correlationId);const t={apiId:At,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},r=this.config.auth.onRedirectNavigate;return"function"==typeof r?(this.logger.verbose("1nehvl",this.correlationId),!1!==r(e)?(this.logger.verbose("1a0jxh",this.correlationId),void await this.navigationClient.navigateExternal(e,t)):void this.logger.verbose("09k5h5",this.correlationId)):(this.logger.verbose("0klwf7",this.correlationId),void await this.navigationClient.navigateExternal(e,t))}throw this.logger.info("0rlh4e",this.correlationId),He(ze)}async logout(e){this.logger.verbose("1rkurh",this.correlationId);const r=this.initializeLogoutRequest(e),n=rs(961,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{this.eventHandler.emitEvent(ho,this.correlationId,_t.Redirect,e),await os(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,r.account);const t={apiId:961,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(o.authority.protocolMode===vr)try{o.authority.endSessionEndpoint}catch{if(r.account?.homeAccountId)return void this.eventHandler.emitEvent(lo,this.correlationId,_t.Redirect,r)}const i=o.getLogoutUri(r);r.account?.homeAccountId&&this.eventHandler.emitEvent(lo,this.correlationId,_t.Redirect,r);const s=this.config.auth.onRedirectNavigate;if("function"!=typeof s)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,mt),void await this.navigationClient.navigateExternal(i,t);if(!1!==s(i))return this.logger.verbose("06v57e",this.correlationId),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,mt),void await this.navigationClient.navigateExternal(i,t);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("0xqes1",this.correlationId)}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),this.eventHandler.emitEvent(uo,this.correlationId,_t.Redirect,null,e),this.eventHandler.emitEvent(go,this.correlationId,_t.Redirect),e}this.eventHandler.emitEvent(go,this.correlationId,_t.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return pr.getAbsoluteUrl(t,ai())}}async function Ks(e,t,r,n){if(!e)throw r.info("1l7hyp",n),He(ze);return Or($s,"silentHandlerLoadFrameSync",r,t,n)(e)}async function Bs(e,t,r,n,o){const i=Js();if(!i.contentDocument)throw"No document associated with iframe!";return(await bs(i.contentDocument,e,t,r,n,o)).submit(),i}async function js(e,t,r,n,o){const i=Js();if(!i.contentDocument)throw"No document associated with iframe!";return(await ks(i.contentDocument,e,t,r,n,o)).submit(),i}function $s(e){const t=Js();return t.src=e,t}function Js(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),e.setAttribute("allow","local-network-access *"),document.body.appendChild(e),e}class Ws extends cs{constructor(e,t,r,n,o,i,s,a,c,h,l){super(e,t,r,n,o,i,a,h,l),this.apiId=s,this.nativeStorage=c}async acquireToken(e){e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("1kl318",this.correlationId);const t={...e};t.prompt?t.prompt!==G&&"no_session"!==t.prompt&&(this.logger.warning("0bmctg",this.correlationId),t.prompt=G):t.prompt=G;const r=await xr(hs,ke,this.logger,this.performanceClient,this.correlationId)(t,_t.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);return r.platformBroker=Fs(this.config,this.logger,this.correlationId,this.platformAuthProvider,r.authenticationScheme),ui(r.authority),this.config.system.protocolMode===kr?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let r;const n=rs(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{return r=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await xr(this.silentTokenHelper.bind(this),ye,this.logger,this.performanceClient,e.correlationId)(r,e)}catch(o){if(o instanceof t&&(o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o)),!(r&&o instanceof t&&o.errorCode===ot))throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),await xr(this.silentTokenHelper.bind(this),ye,this.logger,this.performanceClient,this.correlationId)(r,e)}}async executeEarFlow(e){const{correlationId:t,authority:r,azureCloudOptions:n,extraQueryParameters:o,account:i}=e,s=await xr(ns,ge,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,n,o,i),a=await xr(Wt,Re,this.logger,this.performanceClient,t)(),c=await xr(Ps,_e,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),h={...e,earJwk:a,codeChallenge:c.challenge};await xr(js,we,this.logger,this.performanceClient,t)(this.config,s,h,this.logger,this.performanceClient);const l=this.config.auth.OIDCOptions.responseMode,d=await xr(si,Ie,this.logger,this.performanceClient,t)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,e),u=Or(ls,Se,this.logger,this.performanceClient,t)(d,l,this.logger,this.correlationId);if(!u.ear_jwe&&u.code){const r=await xr(this.createAuthCodeClient.bind(this),Ce,this.logger,this.performanceClient,t)({serverTelemetryManager:rs(this.apiId,this.config.auth.clientId,t,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:s});return xr(Ss,Te,this.logger,this.performanceClient,t)(h,u,c.verifier,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}return xr(_s,be,this.logger,this.performanceClient,t)(h,u,this.apiId,this.config,s,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(He($e))}async silentTokenHelper(e,t){const r=t.correlationId,n=await xr(Ps,_e,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),o={...t,codeChallenge:n.challenge};if(t.httpMethod===M)await xr(Bs,we,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);else{const t=await xr(vs,Tr,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);await xr(Ks,we,this.logger,this.performanceClient,r)(t,this.performanceClient,this.logger,r)}const i=this.config.auth.OIDCOptions.responseMode,s=await xr(si,Ie,this.logger,this.performanceClient,r)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,t),a=Or(ls,Se,this.logger,this.performanceClient,r)(s,i,this.logger,this.correlationId);return xr(Ss,Te,this.logger,this.performanceClient,r)(t,a,n.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class Vs{constructor(e,t){this.config=Ni(e),this.logger=new Ti(this.config.loggerOptions,Sn,_n),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireToken(e,t){const r=Hr(),n=await xr(this.executeTokenRequest.bind(this),"refreshTokenClientExecuteTokenRequest",this.logger,this.performanceClient,e.correlationId)(e,this.authority),o=n.headers?.[D],i=new Di(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body,e.correlationId),xr(i.handleServerTokenResponse.bind(i),Pr,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,r,e,t,void 0,void 0,!0,e.forceCache,o)}async acquireTokenByRefreshToken(e,t){if(!e)throw ar("token_request_empty");if(!e.account)throw o(g);if(this.cacheManager.isAppMetadataFOCI(e.account.environment,e.correlationId))try{return await xr(this.acquireTokenWithCachedRefreshToken.bind(this),Ar,this.logger,this.performanceClient,e.correlationId)(e,!0,t)}catch(r){const n=r instanceof cn&&r.errorCode===tn,o=r instanceof Hi&&"invalid_grant"===r.errorCode&&"client_mismatch"===r.subError;if(n||o)return xr(this.acquireTokenWithCachedRefreshToken.bind(this),Ar,this.logger,this.performanceClient,e.correlationId)(e,!1,t);throw r}return xr(this.acquireTokenWithCachedRefreshToken.bind(this),Ar,this.logger,this.performanceClient,e.correlationId)(e,!1,t)}async acquireTokenWithCachedRefreshToken(e,t,r){const n=Or(this.cacheManager.getRefreshToken.bind(this.cacheManager),"cacheManagerGetRefreshToken",this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0);if(!n)throw ln(tn);if(n.expiresOn){const t=e.refreshTokenExpirationOffsetSeconds||300;if(this.performanceClient?.addFields({cacheRtExpiresOnSeconds:Number(n.expiresOn),rtOffsetSeconds:t},e.correlationId),Dr(n.expiresOn,t))throw ln(rn)}const o={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||le.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ki}};try{return await xr(this.acquireToken.bind(this),"refreshTokenClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(o,r)}catch(t){if(t instanceof cn&&t.subError===on){this.logger.verbose("1pg3ap",e.correlationId);const t=this.cacheManager.generateCredentialKey(n);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw t}}async executeTokenRequest(e,t){const r=Gi(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),n=pr.appendQueryString(t.tokenEndpoint,r),o=await xr(this.createTokenRequestBody.bind(this),"refreshTokenClientCreateTokenRequestBody",this.logger,this.performanceClient,e.correlationId)(e),i=Vi(this.logger,this.config.systemOptions.preventCorsPreflight,e.ccsCredential),s=Cn(this.config.authOptions.clientId,e);return xr(Qi,"refreshTokenClientExecutePostToTokenEndpoint",this.logger,this.performanceClient,e.correlationId)(n,o,i,s,e.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,this.serverTelemetryManager)}async createTokenRequestBody(e){const t=new Map;if(xo(t,e.embeddedClientId||e.extraParameters?.[Co]||this.config.authOptions.clientId),e.redirectUri&&qo(t,e.redirectUri),Oo(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),Wo(t,"refresh_token"),Vo(t),Do(t,this.config.libraryInfo),zo(t,this.config.telemetry.application),ti(t),this.serverTelemetryManager&&!Ui(this.config)&&ei(t,this.serverTelemetryManager),function(e,t){e.set("refresh_token",t)}(t,e.refreshToken),this.config.clientCredentials.clientSecret&&jo(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;$o(t,await ji(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Jo(t,r.assertionType)}if(e.authenticationScheme===le.POP){const r=new Li(this.cryptoUtils,this.performanceClient);let n;n=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await xr(r.generateCnf.bind(r),_r,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Yo(t,n)}else if(e.authenticationScheme===le.SSH){if(!e.sshJwk)throw ar(gr);Zo(t,e.sshJwk)}if((!cr.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Lo(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ki:try{Uo(t,un(e.ccsCredential.credential))}catch(t){this.logger.verbose("1qhtee",e.correlationId)}break;case Bi:No(t,e.ccsCredential.credential)}return e.embeddedClientId&&ri(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&Qo(t,{...e.extraParameters}),Eo(t,e.correlationId,this.performanceClient),wo(t)}}class Gs extends cs{async acquireToken(e){const t=await xr(is,fe,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger,this.correlationId),r={...e,...t};e.redirectUri&&(r.redirectUri=ts(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId));const n=rs(61,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),o=await this.createRefreshTokenClient({serverTelemetryManager:n,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return xr(o.acquireTokenByRefreshToken.bind(o),"refreshTokenClientAcquireTokenByRefreshToken",this.logger,this.performanceClient,e.correlationId)(r,61).catch((e=>{throw e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e),e}))}logout(){return Promise.reject(He($e))}async createRefreshTokenClient(e){const t=await xr(this.getClientConfiguration.bind(this),ve,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Vs(t,this.performanceClient)}}class Qs extends Yi{constructor(e,t){super(e,t),this.includeRedirectUri=!1}}class Xs extends cs{constructor(e,t,r,n,o,i,s,a,c,h){super(e,t,r,n,o,i,a,c,h),this.apiId=s}async acquireToken(e){if(!e.code)throw He("auth_code_required");const r=await xr(hs,ke,this.logger,this.performanceClient,this.correlationId)(e,_t.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId),n=rs(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const t={...r,code:e.code},o=await xr(this.getClientConfiguration.bind(this),ve,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),i=new Qs(o,this.performanceClient);this.logger.verbose("1uic5e",this.correlationId);const s=new gs(i,this.browserStorage,t,this.logger,this.performanceClient);return await xr(s.handleCodeResponseFromServer.bind(s),Sr,this.logger,this.performanceClient,this.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},r,this.apiId,!1)}catch(e){throw e instanceof t&&(e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e)),e}}logout(){return Promise.reject(He($e))}}function Ys(e,t,r){try{li(e)}catch(e){throw t.end({success:!1},e,r),e}}class Zs{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new nr(this.logger,this.performanceClient):ir,this.eventHandler=new Si(this.logger),this.browserStorage=this.isBrowserEnvironment?new fi(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,en(this.config.auth)):wi(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:gt,cacheRetentionDays:5};this.nativeInternalStorage=new fi(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new Zs(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("16v6hv",e),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){const t=this.getRequestCorrelationId(e);if(this.logger.trace("1f7joy",t),this.initialized)return void this.logger.info("061m5x",t);if(!this.isBrowserEnvironment)return this.logger.info("19fvpi",t),this.initialized=!0,void this.eventHandler.emitEvent(eo,t);const r=this.config.system.allowPlatformBroker,n=this.performanceClient.startMeasurement("initializeClientApplication",t);if(this.eventHandler.emitEvent("msal:initializeStart",t),this.logMultipleInstances(n,t),await xr(this.browserStorage.initialize.bind(this.browserStorage),"initializeCache",this.logger,this.performanceClient,t)(t),r)try{this.platformAuthProvider=await async function(e,t,r,n){e.trace("134j0v",r);const o=function(){let e;try{return e=window[ut],"true"===e?.getItem(Hn)}catch(e){return!1}}();let i;e.trace("04c81g",r);try{o&&(i=await Ls.createProvider(e,t,r)),i||(e.trace("0l3na8",r),i=await Hs.createProvider(e,n||2e3,t,r))}catch(t){e.trace("0icbd7",t)}return i}(this.logger,this.performanceClient,t,this.config.system.nativeBrokerHandshakeTimeout)}catch(e){this.logger.verbose(e,t)}this.config.cache.cacheLocation===dt&&this.eventHandler.subscribeCrossTab(),!this.config.system.navigatePopups&&await this.preGeneratePkceCodes(t),this.initialized=!0,this.eventHandler.emitEvent(eo,t),n.end({allowPlatformBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("02l8bm",""),hi(this.initialized),this.isBrowserEnvironment){const t=e?.hash||"";let r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("1wn9kp","")):this.logger.verbose("0w0gm3",""),r}return this.logger.verbose("12xi63",""),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",""),null;const t=this.browserStorage.getInteractionInProgress()?.type;if(t===mt)return this.logger.verbose("1ywcv2",""),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),n=this.browserStorage.getCachedNativeRequest(),o=n&&this.platformAuthProvider&&!e?.hash;let i,s;try{if(o&&this.platformAuthProvider){const e=n?.correlationId||"";this.eventHandler.emitEvent(so,e,_t.Redirect),i=this.performanceClient.startMeasurement(bn,e),this.logger.trace("12v7is",e);const t=new Is(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,865,this.performanceClient,this.platformAuthProvider,n.accountId,this.nativeInternalStorage,n.correlationId);s=xr(t.handleRedirectPromise.bind(t),"handleNativeRedirectPromise",this.logger,this.performanceClient,i.event.correlationId)(this.performanceClient,i.event.correlationId)}else{const[t,r]=this.browserStorage.getCachedRequest(""),n=t.correlationId;this.eventHandler.emitEvent(so,n,_t.Redirect),i=this.performanceClient.startMeasurement(bn,n),this.logger.trace("0znzs5",n);const o=this.createRedirectClient(n);s=xr(o.handleRedirectPromise.bind(o),"handleRedirectPromise",this.logger,this.performanceClient,i.event.correlationId)(t,r,i,e)}}catch(e){throw this.browserStorage.resetRequestCache(""),e}return s.then((e=>(e?(this.browserStorage.resetRequestCache(e.correlationId),this.eventHandler.emitEvent(oo,e.correlationId,_t.Redirect,e),this.logger.verbose("0ui8f5",e.correlationId),r.length<this.getAllAccounts().length&&(this.eventHandler.emitEvent(ro,e.correlationId,_t.Redirect,e.account),this.logger.verbose("16im3l",e.correlationId)),i.end({success:!0},void 0,e.account)):i.event.errorCode?i.end({success:!1},void 0):i.discard(),this.eventHandler.emitEvent(ao,i.event.correlationId,_t.Redirect),e))).catch((e=>{this.browserStorage.resetRequestCache(i.event.correlationId);const t=e;throw this.eventHandler.emitEvent(io,i.event.correlationId,_t.Redirect,null,t),this.eventHandler.emitEvent(ao,i.event.correlationId,_t.Redirect),i.end({success:!1},t),e}))}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("0os66p",t);const r=this.performanceClient.startMeasurement("acquireTokenPreRedirect",t);r.add({scenarioId:e.scenarioId});const n=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=t=>{const o="function"==typeof n?n(t):void 0;return r.add({navigateCallbackResult:!1!==o}),r.event=r.end({success:!0},void 0,e.account)||r.event,o};try{let n;return di(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,pt),this.eventHandler.emitEvent(no,t,_t.Redirect,e),n=this.platformAuthProvider&&this.canUsePlatformBroker(e)?new Is(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,At,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch((r=>{if(r instanceof ps&&ms(r))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(r instanceof cn)return this.logger.verbose("1ipyz4",t),this.createRedirectClient(t).acquireToken(e);throw r})):this.createRedirectClient(t).acquireToken(e),await n}catch(n){throw this.browserStorage.resetRequestCache(t),2===r.event.status?this.performanceClient.startMeasurement(bn,t).end({success:!1},n,e.account):r.end({success:!1},n,e.account),this.eventHandler.emitEvent(io,t,_t.Redirect,null,n),n}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(kn,t);r.add({scenarioId:e.scenarioId});try{this.logger.verbose("0ch87b",t),Ys(this.initialized,r,e.account),this.browserStorage.setInteractionInProgress(!0,pt,e.overrideInteractionInProgress,t)}catch(e){return Promise.reject(e)}const n=this.getAllAccounts();let o;this.eventHandler.emitEvent(no,t,_t.Popup,e);const i=this.getPreGeneratedPkceCodes(t);return o=this.canUsePlatformBroker(e)?this.acquireTokenNative({...e,correlationId:t},Tt).then((e=>(r.end({success:!0,isNativeBroker:!0},void 0,e.account),e))).catch((r=>{if(r instanceof ps&&ms(r))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,i);if(r instanceof cn)return this.logger.verbose("0yy5fw",t),this.createPopupClient(t).acquireToken(e,i);throw r})):this.createPopupClient(t).acquireToken(e,i),o.then((e=>{const o=n.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(oo,t,_t.Popup,e),o&&this.eventHandler.emitEvent(ro,t,_t.Popup,e.account),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e})).catch((n=>(this.eventHandler.emitEvent(io,t,_t.Popup,null,n),r.end({success:!1},n,e.account),Promise.reject(n)))).finally((async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.navigatePopups||await this.preGeneratePkceCodes(t)}))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&e.increment({visibilityChangeCount:1})}async ssoSilent(e){const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(An,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),Ys(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const n=this.getAllAccounts();let o;return this.logger.verbose("0w1b45",t),this.eventHandler.emitEvent(no,t,_t.Silent,r),o=this.canUsePlatformBroker(r)?this.acquireTokenNative(r,863).catch((e=>{if(e instanceof ps&&ms(e))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw e})):this.createSilentIframeClient(r.correlationId).acquireToken(r),o.then((e=>{const r=n.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(oo,t,_t.Silent,e),r&&this.eventHandler.emitEvent(ro,t,_t.Silent,e.account),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromPlatformBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e})).catch((r=>{throw this.eventHandler.emitEvent(io,t,_t.Silent,null,r),this.ssoSilentMeasurement?.end({success:!1},r,e.account),r})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("0ch6ga",t);const r=this.performanceClient.startMeasurement("acquireTokenByCode",t);Ys(this.initialized,r),this.eventHandler.emitEvent(no,t,_t.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw He("spa_code_and_nativeAccountId_present");if(e.code){const n=e.code;let o=this.hybridAuthCodeResponses.get(n);return o?(this.logger.verbose("0qgp28",t),r.discard()):(this.logger.verbose("06eh73",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then((e=>(this.eventHandler.emitEvent(oo,t,_t.Silent,e),this.hybridAuthCodeResponses.delete(n),r.end({success:!0,isNativeBroker:e.fromPlatformBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e))).catch((e=>{throw this.hybridAuthCodeResponses.delete(n),this.eventHandler.emitEvent(io,t,_t.Silent,null,e),r.end({success:!1},e),e})),this.hybridAuthCodeResponses.set(n,o)),await o}if(e.nativeAccountId){if(this.canUsePlatformBroker(e,e.nativeAccountId)){const n=await this.acquireTokenNative({...e,correlationId:t},866,e.nativeAccountId).catch((e=>{throw e instanceof ps&&ms(e)&&(this.platformAuthProvider=void 0),e}));return r.end({success:!0},void 0,n.account),n}throw He("unable_to_acquire_token_from_native_platform")}throw He("auth_code_or_nativeAccountId_required")}catch(e){throw this.eventHandler.emitEvent(io,t,_t.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){const t=this.getRequestCorrelationId(e);this.logger.trace("10d9hy",t),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement("acquireTokenByCodeAsync",t),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const r=this.createSilentAuthCodeClient(t);return await r.acquireToken(e).then((e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromPlatformBroker}),e))).catch((e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e})).finally((()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)}))}async acquireTokenFromCache(e,t){switch(t){case 0:case 1:case 2:const t=this.createSilentCacheClient(e.correlationId);return xr(t.acquireToken.bind(t),"silentCacheClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e);default:throw o(y)}}async acquireTokenByRefreshToken(e,t){switch(t){case 0:case 2:case 3:case 4:const t=this.createSilentRefreshClient(e.correlationId);return xr(t.acquireToken.bind(t),"silentRefreshClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e);default:throw o(y)}}async acquireTokenBySilentIframe(e){const t=this.createSilentIframeClient(e.correlationId);return xr(t.acquireToken.bind(t),"silentIframeClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e)}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return di(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,mt),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return li(this.initialized),this.browserStorage.setInteractionInProgress(!0,mt),this.createPopupClient(t).logout(e).finally((()=>{this.browserStorage.setInteractionInProgress(!1)}))}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return;const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return Ii(this.logger,this.browserStorage,this.isBrowserEnvironment,this.getRequestCorrelationId(),e)}getAccount(e){return Ci(e,this.logger,this.browserStorage,this.getRequestCorrelationId())}setActiveAccount(e){vi(e,this.browserStorage,this.getRequestCorrelationId())}getActiveAccount(){return ki(this.browserStorage,this.getRequestCorrelationId())}async hydrateCache(e,t){this.logger.verbose("16jycr",e.correlationId);const r=wn(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId,Nr(e.idTokenClaims),963),e.fromPlatformBroker?(this.logger.verbose("1fxyu8",e.correlationId),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,n){const o=this.getRequestCorrelationId(e);if(this.logger.trace("0b9y3p",o),!this.platformAuthProvider)throw He(Ye);return new Is(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,o).acquireToken(e,n)}canUsePlatformBroker(e,t){const r=this.getRequestCorrelationId(e);if(this.logger.trace("1n9lbl",r),!this.platformAuthProvider)return this.logger.trace("0vnu11",r),!1;if(!Fs(this.config,this.logger,r,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("1m4bzf",r),!1;if(e.prompt)switch(e.prompt){case G:case V:case W:this.logger.trace("0vdv8e",r);break;default:return this.logger.trace("0pdzw6",r),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("16lbtk",r),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Ds(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createRedirectClient(e){return new zs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentIframeClient(e){return new Ws(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentCacheClient(e){return new ws(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentRefreshClient(e){return new Gs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentAuthCodeClient(e){return new Xs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,e,this.platformAuthProvider)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return ci(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?$t():""}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0lz9hf",t),this.acquireTokenRedirect({correlationId:t,...e||Pt})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0qw7v5",t),this.acquireTokenPopup({correlationId:t,...e||Pt})}async acquireTokenSilent(e){const r=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(vn,r);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Ys(this.initialized,n,e.account),this.logger.verbose("0x1c4s",r);const o=e.account||this.getActiveAccount();if(!o)throw He("no_account_error");return this.acquireTokenSilentDeduped(e,o,r).then((t=>(n.end({success:!0,fromCache:t.fromCache,isNativeBroker:t.fromPlatformBroker,accessTokenSize:t.accessToken.length,idTokenSize:t.idToken.length},void 0,t.account),{...t,state:e.state,correlationId:r}))).catch((e=>{throw e instanceof t&&e.setCorrelationId(r),n.end({success:!1},e,o),e}))}async acquireTokenSilentDeduped(e,t,r){const n=Cn(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),o=JSON.stringify(n),i=this.activeSilentTokenRequests.get(o);if(void 0===i){this.logger.verbose("0fcjbk",r),this.performanceClient.addFields({deduped:!1},r);const n=xr(this.acquireTokenSilentAsync.bind(this),"acquireTokenSilentAsync",this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(o,n),n.finally((()=>{this.activeSilentTokenRequests.delete(o)}))}return this.logger.verbose("1yq7nb",r),this.performanceClient.addFields({deduped:!0},r),i}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.eventHandler.emitEvent(no,e.correlationId,_t.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const n=await xr(ss,"initializeSilentRequest",this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||0;return this.acquireTokenSilentNoIframe(n,o).catch((async t=>{const r=function(e,t){const r=!(e instanceof cn&&e.subError!==on),n=e.errorCode===ot||e.errorCode===y,o=r&&n||e.errorCode===tn||e.errorCode===rn,i=Ot.includes(t);return o&&i}(t,o);if(r){const r=`${t.errorCode}${t.subError?`|${t.subError}`:""}`;if(this.performanceClient.addFields({silentRefreshReason:r},e.correlationId),this.activeIframeRequest){if(5!==o){const[e,r]=this.activeIframeRequest;this.logger.verbose("1w8fso",n.correlationId);const i=this.performanceClient.startMeasurement("awaitConcurrentIframe",n.correlationId);i.add({awaitIframeCorrelationId:r});const s=await e;if(i.end({success:s}),s)return this.logger.verbose("0ywzzi",n.correlationId),this.acquireTokenSilentNoIframe(n,o);throw this.logger.info("17y14q",n.correlationId),t}return this.logger.warning("1bd4p8",n.correlationId),xr(this.acquireTokenBySilentIframe.bind(this),me,this.logger,this.performanceClient,n.correlationId)(n)}{let e;return this.activeIframeRequest=[new Promise((t=>{e=t})),n.correlationId],this.logger.verbose("0rh08z",n.correlationId),xr(this.acquireTokenBySilentIframe.bind(this),me,this.logger,this.performanceClient,n.correlationId)(n).then((t=>(e(!0),t))).catch((t=>{throw e(!1),t})).finally((()=>{this.activeIframeRequest=void 0}))}}throw t})).then((t=>(this.eventHandler.emitEvent(oo,e.correlationId,_t.Silent,t),e.correlationId&&this.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromPlatformBroker},e.correlationId),t))).catch((t=>{throw this.eventHandler.emitEvent(io,e.correlationId,_t.Silent,null,t),t})).finally((()=>{document.removeEventListener("visibilitychange",r)}))}async acquireTokenSilentNoIframe(e,t){return Fs(this.config,this.logger,e.correlationId,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("0sczo4",e.correlationId),this.acquireTokenNative(e,61,e.account.nativeAccountId,t).catch((async t=>{if(t instanceof ps&&ms(t))throw this.logger.verbose("07rkmb",e.correlationId),this.platformAuthProvider=void 0,o(y);throw t}))):(this.logger.verbose("0ox81t",e.correlationId),1===t&&this.logger.verbose("0fvwxe",e.correlationId),xr(this.acquireTokenFromCache.bind(this),"acquireTokenFromCache",this.logger,this.performanceClient,e.correlationId)(e,t).catch((r=>{if(1===t)throw r;return this.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",e.correlationId,_t.Silent,e),xr(this.acquireTokenByRefreshToken.bind(this),"acquireTokenByRefreshToken",this.logger,this.performanceClient,e.correlationId)(e,t)})))}async preGeneratePkceCodes(e){return this.logger.verbose("1x6uj6",e),this.pkceCode=await xr(Ps,_e,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,t?this.logger.verbose("12js1o",e):this.logger.verbose("1oe9ci",e),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e,t){const r=this.config.auth.clientId;window&&(window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("1qtz3l",t),window.msal.clientIds.push(r),function(e,t,r,n){const o=window.msal?.clientIds||[],i=o.length,s=o.filter((t=>t===e)).length;s>1&&r.warning("1e88vg",n),t.add({msalInstanceCount:i,sameClientIdInstanceCount:s})}(r,e,this.logger,t))}}class ea{static loggerCallback(e,t){switch(e){case bi.Error:return void console.error(t);case bi.Info:return void console.info(t);case bi.Verbose:return void console.debug(t);case bi.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=function({auth:e,cache:t,system:r,telemetry:n},o){const i={clientId:"",authority:`${b}`,knownAuthorities:[],cloudDiscoveryMetadata:"",authorityMetadata:"",redirectUri:"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:"",postLogoutRedirectUri:"",clientCapabilities:[],OIDCOptions:{responseMode:"fragment",defaultScopes:[_,P,E]},azureCloudOptions:{azureCloudInstance:br,tenant:""},instanceAware:!1},s={cacheLocation:ut,cacheRetentionDays:5},a={loggerCallback:()=>{},logLevel:bi.Info,piiLoggingEnabled:!1},c={...{...Pi,loggerOptions:a,networkClient:o?new qs:Os,navigationClient:new xs,popupBridgeTimeout:r?.popupBridgeTimeout||6e4,iframeBridgeTimeout:r?.iframeBridgeTimeout||1e4,redirectNavigationTimeout:3e4,allowRedirectInIframe:!1,navigatePopups:!0,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||2e3,protocolMode:"AAD"},...r,loggerOptions:r?.loggerOptions||a},h={application:{appName:"",appVersion:""},client:new _i};if(r?.protocolMode!==vr&&e?.OIDCOptions&&new Ti(c.loggerOptions).warning(JSON.stringify(ar("cannot_set_OIDCOptions")),""),r?.protocolMode&&r.protocolMode===vr&&c?.allowPlatformBroker)throw ar("cannot_allow_platform_broker");return{auth:{...i,...e,OIDCOptions:{...i.OIDCOptions,...e?.OIDCOptions}},cache:{...s,...t},system:c,telemetry:{...h,...n}}}(e,this.browserEnvironment);try{t=window[ut]}catch(e){}const r=t?.getItem(Nn),n=t?.getItem(Un)?.toLowerCase(),o="true"===n||"false"!==n&&void 0,i={...this.config.system.loggerOptions},s=r&&Object.keys(bi).includes(r)?bi[r]:void 0;s&&(i.loggerCallback=ea.loggerCallback,i.logLevel=s),void 0!==o&&(i.piiLoggingEnabled=o),this.logger=new Ti(i,"@azure/msal-browser",pi),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class ta extends ea{getModuleName(){return ta.MODULE_NAME}getId(){return ta.ID}async initialize(e){return this.available="undefined"!=typeof window,this.available}}ta.MODULE_NAME="",ta.ID="StandardOperatingContext";const ra="NESTED_APP_AUTH_UNAVAILABLE";class na{constructor(e,t,r,n){this.clientId=e,this.clientCapabilities=t,this.crypto=r,this.logger=n}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const r=e.correlationId||this.crypto.createNewGuid(),n=Xo(e.claims,this.clientCapabilities),o=e.scopes||N;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:o.join(" "),correlationId:r,claims:cr.isEmptyObj(n)?void 0:n,state:e.state,authenticationScheme:e.authenticationScheme||le.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,r){if(!t.token.id_token||!t.token.access_token)throw o(a);const n=Fr(r+(t.token.expires_in||0)),i=Mr(t.token.id_token,this.crypto.base64Decode),s=this.fromNaaAccountInfo(t.account,t.token.id_token,i),c=t.token.scope||e.scope;return{authority:t.token.authority||s.environment,uniqueId:s.localAccountId,tenantId:s.tenantId,scopes:c.split(" "),account:s,idToken:t.token.id_token,idTokenClaims:i,accessToken:t.token.access_token,fromCache:!1,expiresOn:n,tokenType:e.authenticationScheme||le.BEARER,correlationId:e.correlationId,extExpiresOn:n,state:e.state}}fromNaaAccountInfo(e,t,r){const n=r||e.idTokenClaims,i=e.localAccountId||n?.oid||n?.sub||"",s=e.tenantId||fn(n)||"",a=e.homeAccountId||`${i}.${s}`,c=e.environment;if(!c)throw o(p);const h=n?.preferred_username||n?.upn,l=n?.emails?.[0]||null,d=e.username||h||l||"",u=e.name||n?.name||"",g=e.loginHint||n?.login_hint,m=new Map,f=pn(a,i,s,n);return m.set(s,f),{homeAccountId:a,environment:c,tenantId:s,username:d,localAccountId:i,name:u,loginHint:g,idToken:t,idTokenClaims:n,tenantProfiles:m}}fromBridgeError(e){if(!function(e){return void 0!==e.status}(e))return new t("unknown_error","An unknown error occurred");switch(e.status){case"USER_CANCEL":return new n("user_canceled");case"NO_NETWORK":return new n("no_network_connectivity");case"ACCOUNT_UNAVAILABLE":return new n(m);case"DISABLED":return new n(C);case ra:return new n(e.code||C,e.description);case"TRANSIENT_ERROR":case"PERSISTENT_ERROR":return new Hi(e.code,e.description);case"USER_INTERACTION_REQUIRED":return new cn(e.code,e.description);default:return new t(e.code,e.description)}}toAuthenticationResultFromCache(e,t,r,n,i){if(!t||!r)throw o(a);const s=Mr(t.secret,this.crypto.base64Decode),c=r.target||n.scopes.join(" ");return{authority:r.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:c.split(" "),account:e,idToken:t.secret,idTokenClaims:s||{},accessToken:r.secret,fromCache:!0,expiresOn:Fr(r.expiresOn),extExpiresOn:Fr(r.extendedExpiresOn),tokenType:n.authenticationScheme||le.BEARER,correlationId:i,state:n.state}}}class oa extends t{constructor(e,t){super(e,t),Object.setPrototypeOf(this,oa.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new oa("unsupported_method")}}class ia{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new nr(this.logger,this.performanceClient,!0):ir,this.eventHandler=new Si(this.logger),this.browserStorage=this.operatingContext.isBrowserEnvironment()?new fi(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,en(this.config.auth)):wi(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler),this.nestedAppAuthAdapter=new na(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);const r=this.bridgeProxy.getAccountContext();this.currentAccountContext=r||null}static async createController(e){const t=new ia(e);return Promise.resolve(t)}async initialize(e,t){const r=e?.correlationId||$t();return await this.browserStorage.initialize(r),Promise.resolve()}ensureValidRequest(e){return e?.correlationId?e:{...e,correlationId:this.browserCrypto.createNewGuid()}}async acquireTokenInteractive(e){const r=this.ensureValidRequest(e),n=r.correlationId||$t();this.eventHandler.emitEvent(no,n,_t.Popup,r);const o=this.performanceClient.startMeasurement(kn,n);o.add({nestedAppAuthRequest:!0});try{const t=this.nestedAppAuthAdapter.toNaaTokenRequest(r),i=Hr(),s=await this.bridgeProxy.getTokenInteractive(t),a={...this.nestedAppAuthAdapter.fromNaaTokenResponse(t,s,i)};try{await this.hydrateCache(a,e)}catch(e){this.logger.warningPii("1mwr91",n)}return this.currentAccountContext={homeAccountId:a.account.homeAccountId,environment:a.account.environment,tenantId:a.account.tenantId},this.eventHandler.emitEvent(oo,n,_t.Popup,a),o.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),o.end({success:!0,requestId:a.requestId},void 0,a.account),a}catch(r){const i=r instanceof t?r:this.nestedAppAuthAdapter.fromBridgeError(r);throw this.eventHandler.emitEvent(io,n,_t.Popup,null,r),o.end({success:!1},r,e.account),i}}async acquireTokenSilentInternal(e){const r=this.ensureValidRequest(e),n=r.correlationId||$t();this.eventHandler.emitEvent(no,n,_t.Silent,r);const o=await this.acquireTokenFromCache(r);if(o)return this.eventHandler.emitEvent(oo,n,_t.Silent,o),o;const i=this.performanceClient.startMeasurement(An,n);i.increment({visibilityChangeCount:0}),i.add({nestedAppAuthRequest:!0});try{const t=this.nestedAppAuthAdapter.toNaaTokenRequest(r);t.forceRefresh=r.forceRefresh;const o=Hr(),s=await this.bridgeProxy.getTokenSilent(t),a=this.nestedAppAuthAdapter.fromNaaTokenResponse(t,s,o);try{await this.hydrateCache(a,e)}catch(e){this.logger.warningPii("1mwr91",n)}return this.currentAccountContext={homeAccountId:a.account.homeAccountId,environment:a.account.environment,tenantId:a.account.tenantId},this.eventHandler.emitEvent(oo,n,_t.Silent,a),i?.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),i?.end({success:!0,requestId:a.requestId},void 0,a.account),a}catch(r){const o=r instanceof t?r:this.nestedAppAuthAdapter.fromBridgeError(r);throw this.eventHandler.emitEvent(io,n,_t.Silent,null,r),i?.end({success:!1},r,e.account),o}}async acquireTokenFromCache(e){const t=e.correlationId||$t(),r=this.performanceClient.startMeasurement(vn,t);if(r?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("11t57w",t),null;if(e.forceRefresh)return this.logger.verbose("1ovnmo",t),null;let n=null;switch(e.cacheLookupPolicy||(e.cacheLookupPolicy=0),e.cacheLookupPolicy){case 0:case 1:case 2:n=await this.acquireTokenFromCacheInternal(e);break;default:return null}return n?(this.eventHandler.emitEvent(oo,t,_t.Silent,n),r.add({accessTokenSize:n.accessToken.length,idTokenSize:n.idToken.length}),r.end({success:!0},void 0,n.account),n):(this.logger.warning("1yb4fi",t),this.eventHandler.emitEvent(io,t,_t.Silent,null),r.end({success:!1},void 0,e.account),null)}async acquireTokenFromCacheInternal(e){const t=this.bridgeProxy.getAccountContext()||this.currentAccountContext,r=e.correlationId||$t();let n=null;if(t&&(n=Ci(t,this.logger,this.browserStorage,r)),!n)return this.logger.verbose("10qnr0",r),Promise.resolve(null);this.logger.verbose("1u7hux",r);const o={...e,correlationId:r,authority:e.authority||n.environment,scopes:e.scopes?.length?e.scopes:[...N]},i=this.browserStorage.getTokenKeys(),s=this.browserStorage.getAccessToken(n,o,i,n.tenantId);if(!s)return this.logger.verbose("03vm49",r),Promise.resolve(null);if(Kr(s.cachedAt)||Dr(s.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("18egye",r),Promise.resolve(null);const a=this.browserStorage.getIdToken(n,o.correlationId,i,n.tenantId);return a?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(n,a,s,o,o.correlationId):(this.logger.verbose("0d68kd",r),Promise.resolve(null))}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw oa.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw oa.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw oa.createUnsupportedError()}removePerformanceCallback(e){throw oa.createUnsupportedError()}getAllAccounts(e){return Ii(this.logger,this.browserStorage,this.isBrowserEnv(),$t(),e)}getAccount(e){return Ci(e,this.logger,this.browserStorage,$t())}setActiveAccount(e){return vi(e,this.browserStorage,$t())}getActiveAccount(){return ki(this.browserStorage,$t())}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||Pt)}loginRedirect(e){throw oa.createUnsupportedError()}logoutRedirect(e){throw oa.createUnsupportedError()}logoutPopup(e){throw oa.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("1k8729","")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw oa.createUnsupportedError()}getRedirectResponse(){throw oa.createUnsupportedError()}async clearCache(e){throw oa.createUnsupportedError()}async hydrateCache(e,t){this.logger.verbose("16jycr",e.correlationId);const r=wn(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId,Nr(e.idTokenClaims),963),this.browserStorage.hydrateCache(e,t)}}class sa{static async initializeNestedAppAuthBridge(){if(void 0===window)throw new Error("window is undefined");if(void 0===window.nestedAppAuthBridge)throw new Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",(e=>{const t="string"==typeof e?e:e.data,r=JSON.parse(t),n=sa.bridgeRequests.find((e=>e.requestId===r.requestId));void 0!==n&&(sa.bridgeRequests.splice(sa.bridgeRequests.indexOf(n),1),r.success?n.resolve(r):n.reject(r.error))}));const e=await new Promise(((e,t)=>{const r=sa.buildRequest("GetInitContext"),n={requestId:r.requestId,method:r.method,resolve:e,reject:t};sa.bridgeRequests.push(n),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}));return sa.validateBridgeResultOrThrow(e.initContext)}catch(e){throw window.console.log(e),e}}getTokenInteractive(e){return this.getToken("GetTokenPopup",e)}getTokenSilent(e){return this.getToken("GetToken",e)}async getToken(e,t){const r=await this.sendRequest(e,{tokenParams:t});return{token:sa.validateBridgeResultOrThrow(r.token),account:sa.validateBridgeResultOrThrow(r.account)}}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(e,t){return{messageType:"NestedAppAuthRequest",method:e,requestId:$t(),sendTime:Date.now(),clientLibrary:st,clientLibraryVersion:pi,...t}}sendRequest(e,t){const r=sa.buildRequest(e,t);return new Promise(((e,t)=>{const n={requestId:r.requestId,method:r.method,resolve:e,reject:t};sa.bridgeRequests.push(n),window.nestedAppAuthBridge.postMessage(JSON.stringify(r))}))}static validateBridgeResultOrThrow(e){if(void 0===e)throw{status:ra};return e}constructor(e,t,r,n){this.sdkName=e,this.sdkVersion=t,this.accountContext=r,this.capabilities=n}static async create(){const e=await sa.initializeNestedAppAuthBridge();return new sa(e.sdkName,e.sdkVersion,e.accountContext,e.capabilities)}}sa.bridgeRequests=[];class aa extends ea{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return aa.MODULE_NAME}getId(){return aa.ID}getBridgeProxy(){return this.bridgeProxy}async initialize(e){try{if("undefined"!=typeof window){"function"==typeof window.__initializeNestedAppAuth&&await window.__initializeNestedAppAuth();const e=await sa.create();this.accountContext=e.getAccountContext(),this.bridgeProxy=e,this.available=void 0!==e}}catch(t){this.logger.infoPii("1mdxyj",e)}return this.logger.info("12jy9a",e),this.available}}aa.MODULE_NAME="",aa.ID="NestedAppOperatingContext";class ca{constructor(e,t){this.controller=t||new Zs(new ta(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}getAccount(e){return this.controller.getAccount(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}let ha;function la(e,t){const r=document.getElementById("status");r.style.color=t?"red":"green",r.textContent=e}async function da(){await async function(){if(!ha){const e={auth:{clientId:"b3f769be-7cb8-4c63-82ba-3dbad230cd37",authority:"https://login.microsoftonline.com/common"},cache:{cacheLocation:"localStorage"}};ha=await async function(e,t,r){const n=t||$t(),o=new aa(e);if(await o.initialize(n),o.isAvailable()){const t=new ia(o),i=r?r(e,t):new ca(e,t);return await i.initialize({correlationId:n}),i}return async function(e){const t=new ca(e);return await t.initialize(),t}(e)}(e)}}();const e={scopes:["User.Read"]};let t=null;try{const r=await ha.acquireTokenSilent(e);console.log("Acquired token silently."),t=r.accessToken}catch(r){if(!(r instanceof cn))throw console.error(`Unable to acquire token silently: ${r}`),r;console.log(`Unable to acquire token silently: ${r}`);try{const r=await ha.acquireTokenPopup(e);console.log("Acquired token interactively."),t=r.accessToken}catch(e){throw console.error(`Unable to acquire token interactively: ${e}`),e}}return t}async function ua(){let e,t;la("",!1);try{e=await da(),la("Token obtained successfully.",!1)}catch(e){return void la("Failed to get token: "+e.message,!0)}try{const r=await fetch("https://graph.microsoft.com/v1.0/me?$select=displayName,mail,jobTitle,department,companyName,mobilePhone,businessPhones,officeLocation",{headers:{Authorization:"Bearer "+e}});if(!r.ok)return void la("Graph API error: "+r.status+" "+r.statusText,!0);t=await r.json()}catch(e){return void la("Graph API request failed: "+e.message,!0)}const r=t.mobilePhone||t.businessPhones&&t.businessPhones[0]||"",n=`<p style="margin:0; padding:0">\n      <strong>${t.displayName||""}</strong><br>\n      ${t.jobTitle?t.jobTitle+"<br>":""}\n      ${t.department?t.department+"<br>":""}\n      ${t.companyName?t.companyName+"<br>":""}\n      ${t.officeLocation?t.officeLocation+"<br>":""}\n      ${t.mail?t.mail+"<br>":""}\n      ${r?r+"<br>":""}\n      web: www.ssc.cas.cz\n    </p>\n    <a href="http://www.ssc.cas.cz/cs/">\n      <img alt="" height="40" src="https://cms11.avcr.cz/export/sites/stredisko-spolecnych-cinnosti/.content/galerie-obrazku/podpisy_obraz_zdroje/ssc_logo-01.png" width="235">\n    </a><br><br>\n    <a href="http://www.ssc.cas.cz/cs/banner">\n      <img alt="" height="84" src="http://www.ssc.cas.cz/cs/banner/banner.jpg" width="400">\n    </a>\n    <a href="https://www.ssc.cas.cz/cs/kariera/HR-Award/">\n      <table width="400" border="0" cellpadding="0">\n        <tr>\n          <td width="80" align="left">\n            <img alt="" height="46" src="https://cms11.avcr.cz/export/sites/stredisko-spolecnych-cinnosti/.content/galerie-obrazku/podpisy_obraz_zdroje/hr_award.png" width="68">\n          </td>\n          <td width="320" align="left">\n            <span style="FONT-SIZE: 10pt; COLOR: gray; FONT-FAMILY: 'Calibri'">Jsme dritelem HR Excellence in Research Award</span>\n          </td>\n        </tr>\n      </table>\n    </a>\n  `;Office.context.mailbox.item.body.setSignatureAsync(n,{coercionType:Office.CoercionType.Html},(function(e){e.status===Office.AsyncResultStatus.Failed&&la("Failed to insert signature: "+e.error.message,!0)}))}Office.onReady((e=>{if(e.host===Office.HostType.Outlook){if(!Office.context.requirements.isSetSupported("NestedAppAuth","1.1"))return void la("Nested App Auth is not supported in this Outlook version.",!0);document.getElementById("helloButton").onclick=ua}}))}();
//# sourceMappingURL=taskpane.js.map